üîù Retour au [Sommaire](/SOMMAIRE.md)

# 5.7.4 Pre-commit hooks Git

## Introduction

Les **hooks Git** sont des scripts qui s'ex√©cutent automatiquement √† certains moments cl√©s du workflow Git (avant un commit, avant un push, etc.). Les **pre-commit hooks** en particulier s'ex√©cutent **juste avant** que Git ne cr√©e un commit.

**Pourquoi utiliser un pre-commit hook pour clang-format ?**
- ‚úÖ **Garantit** que tout le code commit√© est bien format√©
- ‚úÖ **√âvite** les commits avec du code mal format√©
- ‚úÖ **Automatise** le formatage sans y penser
- ‚úÖ **Coh√©rence** : Tout le code suit le m√™me style
- ‚úÖ **Revues de code** plus efficaces (pas de discussions sur le style)

Au lieu de se souvenir de formater manuellement, le hook le fait automatiquement !

---

## Qu'est-ce qu'un hook Git ?

### Concept de base

Git permet d'ex√©cuter des scripts personnalis√©s √† diff√©rents moments :

| Type de hook | Quand il s'ex√©cute | Usage typique |
|--------------|-------------------|---------------|
| **pre-commit** | Avant la cr√©ation du commit | V√©rifier le formatage, linter |
| **prepare-commit-msg** | Avant l'√©dition du message | Ajouter des infos au message |
| **commit-msg** | Apr√®s l'√©dition du message | Valider le format du message |
| **post-commit** | Apr√®s la cr√©ation du commit | Notifications |
| **pre-push** | Avant d'envoyer vers le serveur | Lancer les tests |

**Pour clang-format, nous utiliserons `pre-commit`.**

### O√π sont les hooks ?

Les hooks Git sont stock√©s dans le r√©pertoire `.git/hooks/` de votre d√©p√¥t :

```bash
ls .git/hooks/
```

Vous verrez des fichiers d'exemple comme :
- `pre-commit.sample`
- `commit-msg.sample`
- `pre-push.sample`

**‚ö†Ô∏è Important :** Les fichiers `.sample` sont des exemples inactifs. Pour activer un hook, il faut :
1. Cr√©er un fichier **sans** l'extension `.sample`
2. Le rendre ex√©cutable (`chmod +x`)

---

## M√©thode 1 : Hook manuel simple

Cette m√©thode consiste √† cr√©er un script bash simple dans `.git/hooks/`.

### Cr√©er le hook

**1. Cr√©er le fichier :**

```bash
# Se placer √† la racine du d√©p√¥t Git
cd votre_projet

# Cr√©er le hook pre-commit
nano .git/hooks/pre-commit
```

**2. Ajouter le script :**

```bash
#!/bin/bash
# Hook pre-commit pour formater avec clang-format

# R√©cup√©rer les fichiers C/C++ modifi√©s
FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(c|cpp|h|hpp)$')

# Si aucun fichier C/C++, sortir
if [ -z "$FILES" ]; then
    exit 0
fi

# Formater les fichiers
echo "üîß Formatage des fichiers avec clang-format..."  
for file in $FILES; do  
    clang-format -i "$file"
    git add "$file"
    echo "  ‚úÖ $file"
done

echo "‚ú® Formatage termin√© !"  
exit 0  
```

**3. Rendre le script ex√©cutable :**

```bash
chmod +x .git/hooks/pre-commit
```

### Comment √ßa marche

1. Vous modifiez du code C
2. Vous faites `git add` de vos modifications
3. Vous lancez `git commit`
4. **Le hook s'ex√©cute automatiquement**
5. clang-format formate les fichiers
6. Les fichiers format√©s sont ajout√©s au commit
7. Le commit est cr√©√© avec le code format√©

### Test du hook

```bash
# Cr√©er un fichier mal format√©
echo '#include <stdio.h>  
int main(){int x=10;return 0;}' > test.c  

# Ajouter et commiter
git add test.c  
git commit -m "Test du hook"  
```

Vous verrez :
```
üîß Formatage des fichiers avec clang-format...
  ‚úÖ test.c
‚ú® Formatage termin√© !
[main 1234abc] Test du hook
 1 file changed, 5 insertions(+)
```

Le fichier `test.c` est maintenant format√© dans le commit.

### Avantages et inconv√©nients

**‚úÖ Avantages :**
- Simple √† mettre en place
- Pas de d√©pendances externes
- Contr√¥le total sur le script

**‚ùå Inconv√©nients :**
- Chaque d√©veloppeur doit cr√©er le hook manuellement
- Le fichier `.git/hooks/` n'est **pas versionn√©** par Git
- Difficile √† maintenir en √©quipe

---

## M√©thode 2 : Hook versionn√© dans le projet

Pour partager le hook avec toute l'√©quipe, stockez-le dans le d√©p√¥t.

### Structure du projet

```
mon_projet/
‚îú‚îÄ‚îÄ .git/
‚îú‚îÄ‚îÄ .githooks/              ‚Üê Nouveau dossier
‚îÇ   ‚îî‚îÄ‚îÄ pre-commit          ‚Üê Hook versionn√©
‚îú‚îÄ‚îÄ .clang-format
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.c
‚îî‚îÄ‚îÄ README.md
```

### Cr√©er le hook partag√©

**1. Cr√©er le dossier et le hook :**

```bash
# Cr√©er le dossier
mkdir .githooks

# Cr√©er le hook
nano .githooks/pre-commit
```

**2. Contenu du hook :**

```bash
#!/bin/bash
# Hook pre-commit pour clang-format (versionn√©)

set -e

# V√©rifier que clang-format est install√©
if ! command -v clang-format &> /dev/null; then
    echo "‚ùå Erreur : clang-format n'est pas install√©"
    echo "   Installer avec : sudo apt install clang-format"
    exit 1
fi

# R√©cup√©rer les fichiers C/C++ modifi√©s et staged
FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(c|cpp|h|hpp)$' || true)

# Si aucun fichier C/C++, sortir
if [ -z "$FILES" ]; then
    exit 0
fi

# Formater les fichiers
echo "üîß Formatage avec clang-format..."  
echo ""  

FORMATTED=0  
for file in $FILES; do  
    if [ -f "$file" ]; then
        echo "  üìù Formatage de $file"
        clang-format -i "$file"
        git add "$file"
        FORMATTED=$((FORMATTED + 1))
    fi
done

echo ""  
if [ $FORMATTED -gt 0 ]; then  
    echo "‚ú® $FORMATTED fichier(s) format√©(s) avec succ√®s !"
else
    echo "‚úÖ Aucun fichier √† formater"
fi

exit 0
```

**3. Rendre ex√©cutable :**

```bash
chmod +x .githooks/pre-commit
```

**4. Commiter le hook :**

```bash
git add .githooks/  
git commit -m "Ajout du hook pre-commit pour clang-format"  
```

### Configurer Git pour utiliser le dossier

**Chaque d√©veloppeur doit ex√©cuter une fois :**

```bash
git config core.hooksPath .githooks
```

Cette commande indique √† Git d'utiliser `.githooks/` au lieu de `.git/hooks/`.

**Automatiser cette configuration :**

Ajoutez dans votre `README.md` :

```markdown
## Configuration du projet

Apr√®s avoir clon√© le projet, ex√©cutez :

```bash
git config core.hooksPath .githooks
```

Cela activera le formatage automatique avec clang-format.
```

### Script d'installation

Cr√©ez un script `setup.sh` √† la racine :

```bash
#!/bin/bash
# Script d'installation du projet

echo "üöÄ Configuration du projet..."

# Installer les hooks Git
git config core.hooksPath .githooks  
echo "‚úÖ Hooks Git configur√©s"  

# V√©rifier clang-format
if command -v clang-format &> /dev/null; then
    echo "‚úÖ clang-format est install√©"
else
    echo "‚ö†Ô∏è  clang-format n'est pas install√©"
    echo "   Installer avec : sudo apt install clang-format"
fi

echo ""  
echo "‚ú® Configuration termin√©e !"  
echo "Vous pouvez maintenant commencer √† d√©velopper."  
```

**Utilisation :**

```bash
chmod +x setup.sh
./setup.sh
```

### Avantages et inconv√©nients

**‚úÖ Avantages :**
- Hook partag√© avec toute l'√©quipe
- Versionn√© dans Git
- Facile √† maintenir
- Une seule commande pour activer

**‚ùå Inconv√©nients :**
- N√©cessite une √©tape manuelle (`git config`)
- Peut √™tre oubli√© par les nouveaux d√©veloppeurs

---

## M√©thode 3 : Framework pre-commit (recommand√©)

Le framework [pre-commit](https://pre-commit.com/) est un outil Python qui simplifie la gestion des hooks.

### Pourquoi utiliser pre-commit ?

- ‚úÖ Installation simple
- ‚úÖ Configuration centralis√©e dans `.pre-commit-config.yaml`
- ‚úÖ Gestion automatique des d√©pendances
- ‚úÖ Hooks pr√™ts √† l'emploi pour de nombreux outils
- ‚úÖ Mise √† jour facile
- ‚úÖ Standard de facto dans l'industrie

### Installation

**Sur Ubuntu :**

```bash
# M√©thode 1 : Via pip (recommand√©)
pip install pre-commit

# M√©thode 2 : Via apt (version potentiellement ancienne)
sudo apt install pre-commit

# V√©rifier l'installation
pre-commit --version
```

### Configuration

**1. Cr√©er le fichier de configuration :**

√Ä la racine de votre projet, cr√©ez `.pre-commit-config.yaml` :

```yaml
# Configuration pre-commit pour clang-format
repos:
  # Hook pour clang-format
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8  # Version de clang-format
    hooks:
      - id: clang-format
        types_or: [c, c++]

  # Hooks utiles suppl√©mentaires
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace    # Supprime espaces en fin de ligne
      - id: end-of-file-fixer      # Assure ligne vide en fin de fichier
      - id: check-added-large-files # Emp√™che les gros fichiers
      - id: check-yaml             # Valide les fichiers YAML
```

**2. Installer les hooks :**

```bash
pre-commit install
```

Cette commande cr√©e automatiquement le hook dans `.git/hooks/pre-commit`.

**3. Commiter la configuration :**

```bash
git add .pre-commit-config.yaml  
git commit -m "Ajout de la configuration pre-commit"  
```

### Utilisation

**Le hook s'ex√©cute automatiquement :**

```bash
# Modifier un fichier
echo '#include <stdio.h>  
int main(){return 0;}' > test.c  

# Ajouter et commiter
git add test.c  
git commit -m "Test"  
```

Sortie :
```
Trim Trailing Whitespace...........................................Passed  
Fix End of Files...................................................Passed  
Check for added large files........................................Passed  
Check Yaml.........................................................Passed  
clang-format.......................................................Failed  
- hook id: clang-format
- files were modified by this hook

test.c
```

**Le commit est bloqu√©** car des fichiers ont √©t√© modifi√©s. Les fichiers sont maintenant format√©s, il suffit de recommiter :

```bash
git add test.c  
git commit -m "Test"  
```

Cette fois :
```
Trim Trailing Whitespace...........................................Passed  
Fix End of Files...................................................Passed  
Check for added large files........................................Passed  
Check Yaml.........................................................Passed  
clang-format.......................................................Passed  
[main 1234abc] Test
 1 file changed, 5 insertions(+)
```

### Lancer manuellement

**Formater tous les fichiers :**

```bash
pre-commit run --all-files
```

**Formater seulement les fichiers modifi√©s :**

```bash
pre-commit run
```

**Formater un hook sp√©cifique :**

```bash
pre-commit run clang-format --all-files
```

### Mettre √† jour les hooks

```bash
# Mettre √† jour vers les derni√®res versions
pre-commit autoupdate

# Cela modifie .pre-commit-config.yaml avec les nouvelles versions
```

### Configuration avanc√©e

**Personnaliser clang-format :**

```yaml
repos:
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format
        types_or: [c, c++]
        args: ['-style=file', '-i']  # Utiliser .clang-format
        exclude: ^(third_party/|vendor/)  # Exclure certains dossiers
```

**Ajouter d'autres hooks utiles :**

```yaml
repos:
  # clang-format
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format

  # clang-tidy (analyse statique)
  - repo: https://github.com/pocc/pre-commit-hooks
    rev: v1.3.5
    hooks:
      - id: clang-tidy
        args: ['-checks=readability-*,bugprone-*']

  # cppcheck (autre analyseur)
  - repo: https://github.com/pocc/pre-commit-hooks
    rev: v1.3.5
    hooks:
      - id: cppcheck

  # Hooks g√©n√©raux
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: mixed-line-ending
```

### D√©sactiver temporairement

**Commiter sans ex√©cuter les hooks :**

```bash
git commit --no-verify -m "Commit sans hooks"
```

**‚ö†Ô∏è √Ä utiliser avec parcimonie !**

### Installation pour les contributeurs

Dans votre `README.md` :

```markdown
## Installation

1. Cloner le projet :
```bash
git clone https://github.com/user/projet.git  
cd projet  
```

2. Installer pre-commit :
```bash
pip install pre-commit
```

3. Installer les hooks :
```bash
pre-commit install
```

4. (Optionnel) Formater tout le code existant :
```bash
pre-commit run --all-files
```
```

### Avantages et inconv√©nients

**‚úÖ Avantages :**
- Installation simple et standardis√©e
- Configuration version√©e
- Gestion automatique des versions
- Large √©cosyst√®me de hooks disponibles
- Utilis√© par de nombreux projets open-source

**‚ùå Inconv√©nients :**
- D√©pendance Python (mais tr√®s courante)
- N√©cessite installation manuelle par chaque d√©veloppeur

---

## Hook de v√©rification vs formatage automatique

Il existe deux approches : **formater** automatiquement ou **v√©rifier** seulement.

### Approche 1 : Formatage automatique (recommand√©)

Le hook formate automatiquement le code et l'ajoute au commit.

**Avantages :**
- ‚úÖ Aucune action manuelle
- ‚úÖ Garantit le formatage
- ‚úÖ Exp√©rience fluide

**Inconv√©nients :**
- ‚ö†Ô∏è Modifie automatiquement votre code
- ‚ö†Ô∏è Peut surprendre la premi√®re fois

**Configuration :**

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format
        args: ['-i']  # Modification en place
```

### Approche 2 : V√©rification seulement

Le hook v√©rifie le formatage mais **bloque** le commit si le code n'est pas format√©.

**Avantages :**
- ‚úÖ Le d√©veloppeur garde le contr√¥le
- ‚úÖ Peut reviewer les changements avant commit

**Inconv√©nients :**
- ‚ö†Ô∏è N√©cessite de reformater manuellement
- ‚ö†Ô∏è Workflow moins fluide

**Configuration :**

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format
        args: ['--dry-run', '--Werror']  # V√©rification seulement
```

**Avec cette config, si le code n'est pas format√© :**

```bash
git commit -m "Test"
```

Sortie :
```
clang-format.......................................................Failed
- hook id: clang-format
- exit code: 1

test.c
```

Vous devez alors formater manuellement :

```bash
clang-format -i test.c  
git add test.c  
git commit -m "Test"  
```

### Quelle approche choisir ?

| Crit√®re | Formatage auto | V√©rification |
|---------|---------------|--------------|
| **Facilit√©** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **Contr√¥le** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **Vitesse** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **√âquipe d√©butante** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê |
| **√âquipe exp√©riment√©e** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |

**üí° Recommandation :** Formatage automatique pour la plupart des projets.

---

## Int√©gration dans le workflow d'√©quipe

### Communication avec l'√©quipe

**1. Documenter dans le README :**

```markdown
## Formatage du code

Ce projet utilise clang-format pour le formatage automatique du code.

### Installation des hooks

Apr√®s avoir clon√© le projet :

```bash
pip install pre-commit  
pre-commit install  
```

### Utilisation

Le formatage est **automatique** √† chaque commit.  
Vous n'avez rien √† faire !  

### Formater manuellement

```bash
# Formater tous les fichiers
pre-commit run --all-files

# Formater un fichier sp√©cifique
clang-format -i mon_fichier.c
```

### Contourner (√† √©viter)

```bash
git commit --no-verify -m "Message"
```

**‚ö†Ô∏è N'utilisez --no-verify qu'en cas d'urgence !**
```

**2. Onboarding des nouveaux d√©veloppeurs :**

Cr√©ez un guide `CONTRIBUTING.md` :

```markdown
# Guide de contribution

## Setup initial

1. Installer pre-commit :
```bash
pip install pre-commit
```

2. Installer les hooks :
```bash
pre-commit install
```

3. V√©rifier l'installation :
```bash
pre-commit run --all-files
```

## Workflow de d√©veloppement

1. Cr√©er une branche :
```bash
git checkout -b feature/ma-fonctionnalite
```

2. D√©velopper normalement

3. Commiter (formatage automatique) :
```bash
git add .  
git commit -m "feat: Ma nouvelle fonctionnalit√©"  
```

Le formatage se fait automatiquement !

## Probl√®mes courants

### Le hook ne s'ex√©cute pas

```bash
# R√©installer les hooks
pre-commit uninstall  
pre-commit install  
```

### clang-format non trouv√©

```bash
sudo apt install clang-format
```
```

### G√©rer le code existant

**Strat√©gie 1 : Tout formater d'un coup (recommand√©)**

```bash
# Formater tout le code
pre-commit run --all-files

# Ou
find . -name "*.c" -o -name "*.h" | xargs clang-format -i

# Commiter
git add .  
git commit -m "style: Apply clang-format to entire codebase"  
```

**Avantages :**
- ‚úÖ Tout est format√©
- ‚úÖ Probl√®me r√©solu d√©finitivement
- ‚úÖ Un seul commit de style

**Inconv√©nients :**
- ‚ö†Ô∏è Un gros commit
- ‚ö†Ô∏è Peut cr√©er des conflits dans les branches en cours

**Strat√©gie 2 : Formater progressivement**

Configurer pour formater **seulement les lignes modifi√©es** :

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format
        # Seulement les fichiers modifi√©s
        stages: [commit]
```

**Avantages :**
- ‚úÖ Pas de gros commit de style
- ‚úÖ Formatage progressif

**Inconv√©nients :**
- ‚ö†Ô∏è Code mixte (format√© et non format√©)
- ‚ö†Ô∏è Plus long √† converger

---

## Gestion des cas particuliers

### Exclure certains fichiers

**Dans `.pre-commit-config.yaml` :**

```yaml
repos:
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format
        exclude: |
          (?x)^(
            third_party/.*|
            vendor/.*|
            legacy/.*|
            generated/.*
          )$
```

### Exclure certaines sections de code

Dans votre code C, utilisez les commentaires sp√©ciaux :

```c
// clang-format off
int tableau[3][3] = {
    {1, 2, 3},
    {4, 5, 6},
    {7, 8, 9}
};
// clang-format on
```

**‚ö†Ô∏è √Ä utiliser avec parcimonie !**

### Diff√©rents styles selon les dossiers

Ce n'est **pas recommand√©**, mais possible avec plusieurs fichiers `.clang-format` :

```
projet/
‚îú‚îÄ‚îÄ .clang-format          ‚Üê Style par d√©faut
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.c
‚îî‚îÄ‚îÄ legacy/
    ‚îú‚îÄ‚îÄ .clang-format      ‚Üê Style diff√©rent
    ‚îî‚îÄ‚îÄ old_code.c
```

---

## R√©solution de probl√®mes

### Probl√®me : Le hook ne s'ex√©cute pas

**Sympt√¥mes :**
- `git commit` n'ex√©cute pas le hook
- Pas de message de formatage

**Solutions :**

1. **V√©rifier que le hook est install√© :**
```bash
ls -la .git/hooks/pre-commit
```

2. **V√©rifier que le hook est ex√©cutable :**
```bash
chmod +x .git/hooks/pre-commit
```

3. **Avec pre-commit, r√©installer :**
```bash
pre-commit uninstall  
pre-commit install  
```

4. **Tester manuellement :**
```bash
pre-commit run --all-files
```

### Probl√®me : "clang-format not found"

**Solution :**

```bash
# Installer clang-format
sudo apt install clang-format

# V√©rifier
which clang-format
```

### Probl√®me : Le hook est trop lent

**Sympt√¥mes :**
- Commit tr√®s lent
- Beaucoup de fichiers √† formater

**Solutions :**

1. **Formater seulement les fichiers modifi√©s :**

Le hook ne devrait formater que les fichiers staged, pas tous les fichiers du projet.

2. **Utiliser un cache :**

```bash
# pre-commit garde un cache
pre-commit clean  # Nettoyer le cache si probl√®me
```

3. **Parall√©liser (pre-commit le fait d√©j√†) :**

```yaml
# .pre-commit-config.yaml
default_stages: [commit]
```

### Probl√®me : Conflits avec d'autres hooks

**Sympt√¥mes :**
- Plusieurs hooks modifient les m√™mes fichiers
- Comportement incoh√©rent

**Solution :**

Organiser l'ordre des hooks dans `.pre-commit-config.yaml` :

```yaml
repos:
  # 1. D'abord les v√©rifications
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer

  # 2. Ensuite le formatage
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format

  # 3. Enfin les analyses
  - repo: https://github.com/pocc/pre-commit-hooks
    rev: v1.3.5
    hooks:
      - id: clang-tidy
```

### Probl√®me : Le commit est bloqu√© alors que le code semble bon

**Solution :**

1. **V√©rifier les modifications du hook :**
```bash
git diff
```

2. **Ajouter les modifications et recommiter :**
```bash
git add .  
git commit -m "Message"  
```

3. **Si le probl√®me persiste, bypass temporairement :**
```bash
git commit --no-verify -m "Message"
```

---

## Scripts utiles

### Script de diagnostic

Cr√©ez `check-hooks.sh` :

```bash
#!/bin/bash
# V√©rifier la configuration des hooks

echo "=== Diagnostic des hooks Git ==="  
echo ""  

# V√©rifier pre-commit
if command -v pre-commit &> /dev/null; then
    echo "‚úÖ pre-commit est install√©"
    pre-commit --version
else
    echo "‚ùå pre-commit n'est pas install√©"
    echo "   Installer avec : pip install pre-commit"
fi

echo ""

# V√©rifier clang-format
if command -v clang-format &> /dev/null; then
    echo "‚úÖ clang-format est install√©"
    clang-format --version
else
    echo "‚ùå clang-format n'est pas install√©"
    echo "   Installer avec : sudo apt install clang-format"
fi

echo ""

# V√©rifier le hook
if [ -f ".git/hooks/pre-commit" ]; then
    echo "‚úÖ Hook pre-commit trouv√©"

    if [ -x ".git/hooks/pre-commit" ]; then
        echo "‚úÖ Hook est ex√©cutable"
    else
        echo "‚ö†Ô∏è  Hook n'est pas ex√©cutable"
        echo "   Corriger avec : chmod +x .git/hooks/pre-commit"
    fi
else
    echo "‚ùå Pas de hook pre-commit"
    echo "   Installer avec : pre-commit install"
fi

echo ""

# V√©rifier .pre-commit-config.yaml
if [ -f ".pre-commit-config.yaml" ]; then
    echo "‚úÖ Configuration pre-commit trouv√©e"
else
    echo "‚ö†Ô∏è  Pas de .pre-commit-config.yaml"
fi

echo ""

# V√©rifier .clang-format
if [ -f ".clang-format" ]; then
    echo "‚úÖ Configuration clang-format trouv√©e"
else
    echo "‚ö†Ô∏è  Pas de .clang-format"
    echo "   Le style par d√©faut sera utilis√©"
fi

echo ""  
echo "=== Fin du diagnostic ==="  
```

**Utilisation :**

```bash
chmod +x check-hooks.sh
./check-hooks.sh
```

---

## Bonnes pratiques

### 1. Toujours commiter la configuration

```bash
git add .pre-commit-config.yaml .clang-format  
git commit -m "Configure pre-commit hooks and clang-format"  
```

### 2. Documenter clairement

Dans `README.md`, expliquer :
- Comment installer les hooks
- Pourquoi ils sont utilis√©s
- Comment les d√©sactiver si n√©cessaire

### 3. Tester avant de d√©ployer

Avant d'imposer les hooks √† l'√©quipe :

```bash
# Tester sur quelques fichiers
pre-commit run --files test.c

# Tester sur tout le projet
pre-commit run --all-files
```

### 4. √ätre flexible

Permettre `--no-verify` dans certains cas :
- Urgences
- Hotfixes
- Work-in-progress

Mais documenter que c'est exceptionnel.

### 5. Maintenir les hooks √† jour

```bash
# R√©guli√®rement
pre-commit autoupdate  
git add .pre-commit-config.yaml  
git commit -m "Update pre-commit hooks"  
```

### 6. Combiner avec CI/CD

Les hooks locaux peuvent √™tre contourn√©s (`--no-verify`).  
Ajoutez une v√©rification dans le CI/CD (voir section 5.7.5) pour garantir que tout le code est format√©.  

---

## R√©sum√©

### Trois m√©thodes principales

| M√©thode | Difficult√© | Partage | Recommandation |
|---------|-----------|---------|----------------|
| **Hook manuel** | Facile | ‚ùå Difficile | Projets perso |
| **Hook versionn√©** | Moyen | ‚úÖ Bon | Petites √©quipes |
| **Framework pre-commit** | Facile | ‚úÖ Excellent | **Recommand√©** |

### Configuration minimale avec pre-commit

**1. Installer pre-commit :**
```bash
pip install pre-commit
```

**2. Cr√©er `.pre-commit-config.yaml` :**
```yaml
repos:
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v18.1.8
    hooks:
      - id: clang-format
```

**3. Installer les hooks :**
```bash
pre-commit install
```

**4. Commiter :**
```bash
git add .pre-commit-config.yaml  
git commit -m "Add pre-commit configuration"  
```

**C'est tout !** Le formatage est maintenant automatique.

### Points cl√©s

- ‚úÖ Les pre-commit hooks automatisent le formatage
- ‚úÖ Le framework pre-commit est la solution standard
- ‚úÖ Configuration versionnable et partageable
- ‚úÖ S'int√®gre parfaitement avec clang-format
- ‚úÖ Am√©liore la qualit√© du code sans effort
- ‚úÖ √âlimine les discussions de style en revue de code

---

## Pour aller plus loin

Dans la prochaine section, vous d√©couvrirez :
- **5.7.5 Formatage dans le CI/CD** : V√©rification automatique dans GitHub Actions, GitLab CI

Les pre-commit hooks sont la premi√®re ligne de d√©fense pour maintenir un code propre. Combin√©s avec une v√©rification CI/CD, ils garantissent que 100% du code commit√© respecte le style du projet !

‚è≠Ô∏è [Formatage dans le CI/CD](/05-operateurs-et-controle/07.5-formatage-cicd.md)
