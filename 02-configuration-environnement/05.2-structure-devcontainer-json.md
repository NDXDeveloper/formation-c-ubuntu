üîù Retour au [Sommaire](/SOMMAIRE.md)

# 2.5.2 Structure du fichier .devcontainer.json

## Introduction

Maintenant que vous comprenez ce qu'est un DevContainer et pourquoi c'est utile, il est temps de d√©couvrir **comment** cr√©er et configurer un DevContainer. Tout commence par un fichier sp√©cial : le fichier `.devcontainer.json`.

Ce fichier est comme la **recette** de votre environnement de d√©veloppement. Il d√©crit pr√©cis√©ment ce qui doit √™tre install√©, configur√© et activ√© dans votre conteneur.

**Analogie :** Si le DevContainer est une maison, le fichier `.devcontainer.json` est le plan architectural qui sp√©cifie :
- Les fondations (l'image Docker de base)
- Les √©quipements (les outils install√©s)
- L'am√©nagement int√©rieur (les extensions VS Code)
- Les r√®gles de la maison (les param√®tres et configurations)

---

## Emplacement du fichier

Le fichier `.devcontainer.json` doit √™tre plac√© dans un dossier sp√©cial √† la racine de votre projet.

### Structure de dossier recommand√©e

```
mon-projet-c/
‚îú‚îÄ‚îÄ .devcontainer/
‚îÇ   ‚îú‚îÄ‚îÄ devcontainer.json    ‚Üê Le fichier de configuration
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile           ‚Üê (Optionnel) Image Docker personnalis√©e
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.c
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îî‚îÄ‚îÄ header.h
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ README.md
```

**Note :** Le dossier s'appelle `.devcontainer` (avec un point au d√©but, ce qui le rend "cach√©" sous Linux).

### Variantes possibles

VS Code accepte aussi ces emplacements :

```
# Variante 1 : Dossier .devcontainer avec fichier dedans
.devcontainer/devcontainer.json

# Variante 2 : Fichier directement √† la racine
.devcontainer.json

# Variante 3 : Pour plusieurs configurations
.devcontainer/gcc11/devcontainer.json
.devcontainer/gcc12/devcontainer.json
```

**Recommandation pour d√©buter :** Utilisez la variante 1 (`.devcontainer/devcontainer.json`), c'est la plus propre et √©volutive.

---

## Structure de base minimale

Commen√ßons par le strict minimum pour avoir un DevContainer fonctionnel.

### Le DevContainer le plus simple possible

```json
{
    "name": "Mon projet C",
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04"
}
```

**C'est tout !** Avec juste ces deux lignes, vous avez un DevContainer fonctionnel.

**Explications :**

- **`name`** : Le nom de votre environnement (affich√© dans VS Code)
- **`image`** : L'image Docker √† utiliser (ici, une image pr√©-configur√©e par Microsoft avec Ubuntu 22.04 et les outils C/C++)

Quand VS Code ouvre ce DevContainer :
1. Il t√©l√©charge l'image sp√©cifi√©e
2. Cr√©e un conteneur bas√© sur cette image
3. Vous connecte √† ce conteneur

### Version l√©g√®rement enrichie

```json
{
    "name": "Environnement C - GCC 11",
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04",

    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools"
            ]
        }
    }
}
```

Cette version ajoute automatiquement l'extension C/C++ de Microsoft dans le conteneur.

---

## Anatomie compl√®te d'un fichier .devcontainer.json

Voyons maintenant toutes les sections possibles d'un fichier `.devcontainer.json` pour comprendre ce qu'on peut configurer.

### Structure compl√®te (comment√©e)

```json
{
    // ============================================
    // IDENTIFICATION
    // ============================================
    "name": "Nom affich√© dans VS Code",

    // ============================================
    // IMAGE DE BASE
    // ============================================
    "image": "ubuntu:22.04",
    // OU
    "dockerFile": "Dockerfile",
    // OU
    "build": {
        "dockerfile": "Dockerfile",
        "context": "..",
        "args": {
            "VARIANT": "22.04"
        }
    },

    // ============================================
    // FONCTIONNALIT√âS ADDITIONNELLES
    // ============================================
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {},
        "ghcr.io/devcontainers/features/git:1": {}
    },

    // ============================================
    // CONFIGURATION VS CODE
    // ============================================
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools",
                "ms-vscode.cmake-tools"
            ],
            "settings": {
                "C_Cpp.default.cStandard": "c17",
                "editor.formatOnSave": true
            }
        }
    },

    // ============================================
    // MONTAGE DE VOLUMES
    // ============================================
    "mounts": [
        "source=${localWorkspaceFolder}/data,target=/workspace/data,type=bind"
    ],

    // ============================================
    // PORTS
    // ============================================
    "forwardPorts": [8080, 3000],
    "portsAttributes": {
        "8080": {
            "label": "Serveur Web",
            "onAutoForward": "notify"
        }
    },

    // ============================================
    // COMMANDES DE CYCLE DE VIE
    // ============================================
    "postCreateCommand": "sudo apt-get update && sudo apt-get install -y valgrind",
    "postStartCommand": "echo 'Container started!'",
    "postAttachCommand": "echo 'Welcome to your dev environment!'",

    // ============================================
    // UTILISATEUR
    // ============================================
    "remoteUser": "vscode",
    "containerUser": "vscode",

    // ============================================
    // VARIABLES D'ENVIRONNEMENT
    // ============================================
    "remoteEnv": {
        "MY_VAR": "valeur",
        "PATH": "${containerEnv:PATH}:/custom/path"
    },

    // ============================================
    // OPTIONS DOCKER
    // ============================================
    "runArgs": [
        "--cap-add=SYS_PTRACE",
        "--security-opt",
        "seccomp=unconfined"
    ],

    // ============================================
    // AUTRES OPTIONS
    // ============================================
    "shutdownAction": "stopContainer",
    "updateContentCommand": "make clean && make",
    "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
    "workspaceFolder": "/workspace"
}
```

**Rassurez-vous !** Vous n'avez pas besoin d'utiliser toutes ces options. Voyons maintenant chaque section en d√©tail.

---

## Section 1 : Identification

### name

```json
{
    "name": "Environnement C - Ubuntu 22.04 GCC 11"
}
```

Le nom qui appara√Æt dans VS Code pour identifier votre DevContainer.

**Bonnes pratiques :**
- Soyez descriptif : incluez le langage, la version d'OS, le compilateur
- Exemple : "Projet C - GCC 12 - CMake"

---

## Section 2 : Image de base

C'est **la partie la plus importante**. Elle d√©finit le syst√®me d'exploitation et les outils de base de votre conteneur.

### Option 1 : Utiliser une image pr√©-existante (recommand√© pour d√©buter)

```json
{
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04"
}
```

**Images officielles Microsoft pour C/C++ :**
- `mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04` - Ubuntu 22.04
- `mcr.microsoft.com/devcontainers/cpp:ubuntu-20.04` - Ubuntu 20.04
- `mcr.microsoft.com/devcontainers/cpp:debian-11` - Debian 11

Ces images contiennent d√©j√† :
- GCC et Clang
- Make et CMake
- GDB
- Git
- Python
- Divers outils de d√©veloppement

### Option 2 : Utiliser une image Docker standard

```json
{
    "image": "ubuntu:22.04"
}
```

C'est une image Ubuntu "pure" sans outils de d√©veloppement pr√©-install√©s. Vous devrez tout installer vous-m√™me.

### Option 3 : Utiliser un Dockerfile personnalis√© (avanc√©)

```json
{
    "build": {
        "dockerfile": "Dockerfile",
        "context": ".."
    }
}
```

Cette option vous donne le contr√¥le total sur ce qui est install√©. Nous verrons cela en d√©tail dans la section 2.5.3.

---

## Section 3 : Features (fonctionnalit√©s additionnelles)

Les **features** sont des modules pr√©-packag√©s que vous pouvez ajouter facilement √† votre conteneur.

### Qu'est-ce qu'une feature ?

**Analogie :** C'est comme des "packs d'options" pour une voiture. Au lieu de tout installer manuellement, vous cochez des cases pour ajouter la climatisation, le GPS, etc.

### Syntaxe

```json
{
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {
            "installZsh": true,
            "installOhMyZsh": true
        },
        "ghcr.io/devcontainers/features/git:1": {
            "version": "latest"
        }
    }
}
```

### Features populaires pour le d√©veloppement C

```json
{
    "features": {
        // Outils syst√®me communs (zsh, curl, etc.)
        "ghcr.io/devcontainers/features/common-utils:2": {},

        // Git avec configuration
        "ghcr.io/devcontainers/features/git:1": {
            "version": "latest",
            "ppa": false
        },

        // Docker-in-Docker (pour cr√©er des images dans le container)
        "ghcr.io/devcontainers/features/docker-in-docker:2": {},

        // Node.js (utile pour certains outils)
        "ghcr.io/devcontainers/features/node:1": {
            "version": "18"
        },

        // Python (pour scripts d'automatisation)
        "ghcr.io/devcontainers/features/python:1": {
            "version": "3.11"
        }
    }
}
```

**Avantage des features :** Elles sont maintenues par la communaut√©, document√©es et test√©es. C'est plus simple que d'installer manuellement.

**Liste compl√®te :** https://containers.dev/features

---

## Section 4 : Customizations (personnalisation VS Code)

Cette section configure VS Code **√† l'int√©rieur du conteneur**.

### Extensions

```json
{
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools",           // IntelliSense C/C++
                "ms-vscode.cpptools-extension-pack",
                "ms-vscode.cmake-tools",        // Support CMake
                "twxs.cmake",                   // Coloration CMakeLists.txt
                "ms-vscode.makefile-tools",     // Support Makefile
                "usernamehw.errorlens",         // Erreurs visibles
                "oderwat.indent-rainbow",       // Indentation color√©e
                "streetsidesoftware.code-spell-checker"  // Correcteur
            ]
        }
    }
}
```

**Note importante :** Ces extensions sont install√©es **dans le conteneur**, pas sur votre machine h√¥te. Si vous travaillez sur 3 projets avec 3 DevContainers diff√©rents, chacun peut avoir ses propres extensions.

### Settings (param√®tres)

```json
{
    "customizations": {
        "vscode": {
            "settings": {
                // Configuration C/C++
                "C_Cpp.default.cStandard": "c17",
                "C_Cpp.default.compilerPath": "/usr/bin/gcc",
                "C_Cpp.default.intelliSenseMode": "linux-gcc-x64",

                // √âditeur
                "editor.formatOnSave": true,
                "editor.tabSize": 4,
                "editor.insertSpaces": true,

                // Fichiers
                "files.eol": "\n",
                "files.trimTrailingWhitespace": true,

                // Terminal
                "terminal.integrated.defaultProfile.linux": "bash"
            }
        }
    }
}
```

Ces param√®tres sont appliqu√©s automatiquement quand vous ouvrez le DevContainer.

---

## Section 5 : Commandes de cycle de vie

Ces commandes s'ex√©cutent automatiquement √† diff√©rents moments de la vie du conteneur.

### Les diff√©rentes commandes

```json
{
    "postCreateCommand": "commande ex√©cut√©e UNE FOIS apr√®s cr√©ation du conteneur",
    "postStartCommand": "commande ex√©cut√©e √Ä CHAQUE d√©marrage du conteneur",
    "postAttachCommand": "commande ex√©cut√©e quand VS Code se connecte",
    "updateContentCommand": "commande pour mettre √† jour le contenu",
    "initializeCommand": "commande AVANT de cr√©er le conteneur (sur l'h√¥te)"
}
```

### Exemples pratiques

```json
{
    // Installer des outils apr√®s cr√©ation
    "postCreateCommand": "sudo apt-get update && sudo apt-get install -y valgrind gdb",

    // Compiler le projet au d√©marrage
    "postStartCommand": "make clean && make",

    // Message de bienvenue
    "postAttachCommand": "echo 'Bienvenue ! GCC version :' && gcc --version",

    // Mise √† jour des d√©pendances
    "updateContentCommand": "git submodule update --init --recursive"
}
```

### Commandes multiples

Pour ex√©cuter plusieurs commandes, utilisez `&&` ou cr√©ez un script :

```json
{
    // Plusieurs commandes en une ligne
    "postCreateCommand": "sudo apt-get update && sudo apt-get install -y valgrind && pip3 install conan",

    // OU : Appeler un script
    "postCreateCommand": "bash .devcontainer/setup.sh"
}
```

Contenu de `.devcontainer/setup.sh` :
```bash
#!/bin/bash
echo "Configuration de l'environnement..."
sudo apt-get update
sudo apt-get install -y valgrind clang-format
pip3 install conan
echo "‚úì Configuration termin√©e !"
```

---

## Section 6 : Ports

Si vous d√©veloppez un serveur ou une application r√©seau, vous devez exposer les ports.

### forwardPorts

```json
{
    "forwardPorts": [8080, 3000, 5000]
}
```

Ces ports du conteneur seront accessibles depuis votre machine h√¥te.

**Exemple :** Vous lancez un serveur HTTP sur le port 8080 dans le conteneur. Gr√¢ce √† `forwardPorts`, vous pouvez y acc√©der via `http://localhost:8080` depuis votre navigateur sur l'h√¥te.

### portsAttributes (m√©tadonn√©es sur les ports)

```json
{
    "forwardPorts": [8080],
    "portsAttributes": {
        "8080": {
            "label": "Serveur Web",
            "onAutoForward": "notify",
            "protocol": "http"
        }
    }
}
```

VS Code affichera une notification quand le port 8080 est utilis√© et vous proposera d'ouvrir le navigateur.

---

## Section 7 : Mounts (montage de volumes)

Les mounts permettent de partager des dossiers entre l'h√¥te et le conteneur.

### Syntaxe de base

```json
{
    "mounts": [
        "source=${localWorkspaceFolder}/data,target=/workspace/data,type=bind"
    ]
}
```

**Explication :**
- `source` : Chemin sur votre machine h√¥te
- `target` : Chemin dans le conteneur
- `type=bind` : Type de montage (g√©n√©ralement "bind")

### Variables disponibles

- `${localWorkspaceFolder}` : Le dossier de votre projet sur l'h√¥te
- `${localWorkspaceFolderBasename}` : Le nom du dossier
- `${containerWorkspaceFolder}` : Le dossier dans le conteneur

### Exemples pratiques

```json
{
    "mounts": [
        // Partager un cache de compilation
        "source=${localWorkspaceFolder}/.cache,target=/workspace/.cache,type=bind",

        // Partager des donn√©es de test
        "source=${localWorkspaceFolder}/test-data,target=/data,type=bind,readonly",

        // Partager la config Git (pour ne pas la reconfigurer)
        "source=${localEnv:HOME}/.gitconfig,target=/home/vscode/.gitconfig,type=bind"
    ]
}
```

---

## Section 8 : Variables d'environnement

D√©finissez des variables d'environnement dans le conteneur.

### remoteEnv

```json
{
    "remoteEnv": {
        "PROJECT_NAME": "mon-projet-c",
        "COMPILER": "gcc",
        "BUILD_TYPE": "Debug",
        "PATH": "${containerEnv:PATH}:/custom/bin"
    }
}
```

Ces variables seront disponibles dans tous les terminaux du conteneur.

**Utilisation dans le conteneur :**
```bash
echo $PROJECT_NAME  # Affiche : mon-projet-c
echo $COMPILER      # Affiche : gcc
```

---

## Section 9 : Utilisateur

D√©finit quel utilisateur est utilis√© dans le conteneur.

```json
{
    "remoteUser": "vscode",
    "containerUser": "vscode"
}
```

**Explications :**
- **`remoteUser`** : L'utilisateur avec lequel VS Code se connecte
- **`containerUser`** : L'utilisateur qui ex√©cute les processus

**Pourquoi c'est important :**
- Par d√©faut, Docker utilise l'utilisateur `root`
- Travailler en tant que root peut causer des probl√®mes de permissions
- L'utilisateur `vscode` est cr√©√© par les images Microsoft et a les bonnes permissions

**Recommandation :** Gardez `"remoteUser": "vscode"` si vous utilisez une image Microsoft.

---

## Section 10 : Options Docker avanc√©es

### runArgs

Arguments pass√©s √† la commande `docker run`.

```json
{
    "runArgs": [
        "--cap-add=SYS_PTRACE",          // N√©cessaire pour GDB
        "--security-opt",
        "seccomp=unconfined",             // D√©sactive seccomp (pour debugging)
        "--memory=4g",                    // Limite la RAM √† 4 GB
        "--cpus=2"                        // Limite √† 2 CPUs
    ]
}
```

**Pour le d√©veloppement C, ces options sont souvent n√©cessaires :**

```json
{
    "runArgs": [
        "--cap-add=SYS_PTRACE",
        "--security-opt", "seccomp=unconfined"
    ]
}
```

Elles permettent √† GDB de fonctionner correctement (attacher √† des processus, placer des breakpoints, etc.).

---

## Exemple complet : DevContainer pour projet C

Voici un exemple complet et r√©aliste pour un projet C.

### .devcontainer/devcontainer.json

```json
{
    // ============================================
    // IDENTIFICATION
    // ============================================
    "name": "Projet C - Ubuntu 22.04 - GCC 11",

    // ============================================
    // IMAGE DE BASE
    // ============================================
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04",

    // ============================================
    // FEATURES
    // ============================================
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {
            "installZsh": true,
            "installOhMyZsh": true,
            "upgradePackages": true
        },
        "ghcr.io/devcontainers/features/git:1": {
            "version": "latest"
        }
    },

    // ============================================
    // CUSTOMIZATIONS VS CODE
    // ============================================
    "customizations": {
        "vscode": {
            "extensions": [
                // C/C++ essentiels
                "ms-vscode.cpptools",
                "ms-vscode.cpptools-extension-pack",

                // Build systems
                "ms-vscode.cmake-tools",
                "ms-vscode.makefile-tools",

                // Qualit√© de code
                "usernamehw.errorlens",
                "oderwat.indent-rainbow",

                // Git
                "eamodio.gitlens",

                // Utilitaires
                "streetsidesoftware.code-spell-checker",
                "gruntfuggly.todo-tree"
            ],

            "settings": {
                // C/C++
                "C_Cpp.default.cStandard": "c17",
                "C_Cpp.default.compilerPath": "/usr/bin/gcc",
                "C_Cpp.default.intelliSenseMode": "linux-gcc-x64",
                "C_Cpp.clang_format_fallbackStyle": "{ BasedOnStyle: LLVM, IndentWidth: 4 }",

                // √âditeur
                "editor.formatOnSave": true,
                "editor.tabSize": 4,
                "editor.insertSpaces": true,
                "editor.rulers": [80, 120],

                // Fichiers
                "files.eol": "\n",
                "files.trimTrailingWhitespace": true,
                "files.insertFinalNewline": true,

                // Terminal
                "terminal.integrated.defaultProfile.linux": "zsh"
            }
        }
    },

    // ============================================
    // COMMANDES DE CYCLE DE VIE
    // ============================================
    "postCreateCommand": "sudo apt-get update && sudo apt-get install -y valgrind clang-format && echo '‚úì Environnement pr√™t !'",

    // ============================================
    // VARIABLES D'ENVIRONNEMENT
    // ============================================
    "remoteEnv": {
        "CC": "gcc",
        "CFLAGS": "-Wall -Wextra -std=c17"
    },

    // ============================================
    // OPTIONS DOCKER
    // ============================================
    "runArgs": [
        "--cap-add=SYS_PTRACE",
        "--security-opt", "seccomp=unconfined"
    ],

    // ============================================
    // UTILISATEUR
    // ============================================
    "remoteUser": "vscode"
}
```

### R√©sultat

Avec ce fichier, quand vous ouvrez le projet dans VS Code :
1. Un conteneur Ubuntu 22.04 est cr√©√©
2. GCC 11, Git, zsh, oh-my-zsh sont install√©s
3. Valgrind et clang-format sont ajout√©s
4. Toutes les extensions VS Code sont install√©es
5. Les param√®tres sont appliqu√©s
6. GDB fonctionne correctement
7. Vous √™tes pr√™t √† coder en quelques minutes !

---

## Variantes selon le compilateur

### GCC 12

```json
{
    "name": "Projet C - GCC 12",
    "image": "ubuntu:22.04",
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {}
    },
    "postCreateCommand": "sudo apt-get update && sudo apt-get install -y gcc-12 g++-12 make cmake gdb valgrind && sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 100"
}
```

### Clang

```json
{
    "name": "Projet C - Clang 14",
    "image": "ubuntu:22.04",
    "postCreateCommand": "sudo apt-get update && sudo apt-get install -y clang-14 lldb cmake make && sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-14 100",
    "customizations": {
        "vscode": {
            "settings": {
                "C_Cpp.default.compilerPath": "/usr/bin/clang"
            }
        }
    }
}
```

### Alpine Linux (conteneur ultra-l√©ger)

```json
{
    "name": "Projet C - Alpine",
    "image": "alpine:latest",
    "postCreateCommand": "apk add --no-cache gcc musl-dev make cmake gdb valgrind"
}
```

---

## Bonnes pratiques

### 1. Commentez votre fichier

```json
{
    // Utilisez des commentaires pour expliquer les choix
    "name": "Projet C",

    // Ubuntu 22.04 pour GCC 11 et libc r√©cente
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04",

    // Extensions minimales pour ne pas alourdir
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools"  // IntelliSense indispensable
            ]
        }
    }
}
```

### 2. Versionnez le fichier .devcontainer.json

Ce fichier **doit** √™tre commit√© dans Git avec votre projet. C'est un fichier de configuration crucial.

```bash
git add .devcontainer/devcontainer.json
git commit -m "Add DevContainer configuration"
```

### 3. Documentez dans le README

```markdown
## D√©veloppement

Ce projet utilise un DevContainer pour garantir un environnement reproductible.

### Pr√©requis
- Docker
- VS Code avec l'extension "Dev Containers"

### D√©marrage
1. Clonez le d√©p√¥t
2. Ouvrez dans VS Code
3. Cliquez sur "Reopen in Container"
4. Attendez la fin de la configuration (premi√®re fois : ~5 min)

L'environnement contient :
- Ubuntu 22.04
- GCC 11
- Make, CMake, GDB, Valgrind
```

### 4. Gardez-le simple au d√©but

Commencez avec une configuration minimale :

```json
{
    "name": "Mon projet",
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04",
    "customizations": {
        "vscode": {
            "extensions": ["ms-vscode.cpptools"]
        }
    }
}
```

Ajoutez des options au fur et √† mesure des besoins r√©els.

### 5. Testez sur une machine propre

Avant de partager votre DevContainer :
1. Supprimez le conteneur local
2. Recr√©ez-le from scratch
3. V√©rifiez que tout fonctionne

```bash
# Liste les conteneurs
docker ps -a

# Supprime un conteneur
docker rm <container-id>

# Supprime l'image
docker rmi <image-id>
```

### 6. Utilisez des features plut√¥t que postCreateCommand

**Moins bien :**
```json
{
    "postCreateCommand": "apt-get install -y git curl wget"
}
```

**Mieux :**
```json
{
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {}
    }
}
```

Les features sont plus robustes et mieux maintenues.

---

## Validation de votre fichier

### V√©rification de la syntaxe JSON

Le fichier `.devcontainer.json` doit √™tre du JSON valide.

**Erreurs fr√©quentes :**
- Virgule en trop √† la fin : `"value",` (avant `}`)
- Guillemets manquants
- Accolades mal ferm√©es

**VS Code vous aide :** Si vous ouvrez le fichier dans VS Code, la coloration et les erreurs s'affichent automatiquement.

### Sch√©ma de validation

VS Code peut valider automatiquement votre fichier contre le sch√©ma officiel.

Ajoutez au d√©but du fichier :

```json
{
    "$schema": "https://raw.githubusercontent.com/devcontainers/spec/main/schemas/devContainer.schema.json",
    "name": "Mon projet"
}
```

Maintenant, VS Code vous proposera l'auto-compl√©tion et validera la structure.

---

## D√©pannage

### Le conteneur ne d√©marre pas

**Sympt√¥me :** VS Code affiche une erreur au d√©marrage.

**Solutions :**
1. V√©rifiez la syntaxe JSON (pas de virgules en trop)
2. V√©rifiez que Docker est en cours d'ex√©cution : `docker ps`
3. Consultez les logs : VS Code ‚Üí View ‚Üí Output ‚Üí Dev Containers

### Les extensions ne s'installent pas

**Sympt√¥me :** Les extensions list√©es n'apparaissent pas.

**Solutions :**
1. V√©rifiez l'ID de l'extension (format : `publisher.extension-name`)
2. Reconstruisez le conteneur : `Ctrl+Shift+P` ‚Üí "Dev Containers: Rebuild Container"

### postCreateCommand √©choue

**Sympt√¥me :** La commande de post-cr√©ation ne fonctionne pas.

**Solutions :**
1. Testez la commande manuellement dans le conteneur
2. Ajoutez `sudo` si n√©cessaire (droits admin)
3. V√©rifiez les erreurs dans les logs
4. Divisez en plusieurs commandes avec `&&`

---

## R√©capitulatif

√Ä ce stade, vous comprenez :

- ‚úÖ O√π placer le fichier `.devcontainer.json`
- ‚úÖ La structure minimale d'un DevContainer
- ‚úÖ Les diff√©rentes sections du fichier (image, features, customizations, etc.)
- ‚úÖ Comment configurer VS Code dans le conteneur
- ‚úÖ Les commandes de cycle de vie
- ‚úÖ Les options avanc√©es (ports, mounts, variables d'env)
- ‚úÖ Les bonnes pratiques de configuration
- ‚úÖ Comment d√©boguer les probl√®mes courants

**Prochaine √©tape :** Dans la section 2.5.3, nous verrons comment configurer sp√©cifiquement GCC, GDB, CMake et Valgrind dans un DevContainer pour une exp√©rience de d√©veloppement optimale.

---

## Points cl√©s √† retenir

1. **`.devcontainer/devcontainer.json`** : Emplacement standard du fichier
2. **Minimum vital** : `name` + `image` suffisent pour commencer
3. **Image Microsoft** : `mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04` recommand√©e
4. **Features** : Modules pr√©-packag√©s pour ajouter des fonctionnalit√©s
5. **customizations.vscode** : Configure VS Code (extensions + settings)
6. **postCreateCommand** : Commandes apr√®s cr√©ation du conteneur
7. **runArgs** : N√©cessaire pour GDB (`--cap-add=SYS_PTRACE`)
8. **Versionnez** : Le fichier doit √™tre dans Git
9. **Commencez simple** : Ajoutez des options progressivement
10. **$schema** : Active l'auto-compl√©tion et la validation

**Citation :**
> "Configuration as code means your environment is documented, versioned, and reproducible."
> ‚Äî DevOps best practices

---


‚è≠Ô∏è [Configuration GCC/GDB/CMake/Valgrind](/02-configuration-environnement/05.3-configuration-outils.md)
