üîù Retour au [Sommaire](/SOMMAIRE.md)

# 32.1.3 Int√©gration dans le CI

## Introduction

Vous savez maintenant √©crire des commentaires Doxygen (section 32.1.1) et g√©n√©rer la documentation manuellement (section 32.1.2). Mais que se passe-t-il si un d√©veloppeur modifie du code sans mettre √† jour la documentation ? Ou si personne ne pense √† r√©g√©n√©rer la doc avant une release ?

C'est l√† qu'intervient l'**Int√©gration Continue** (CI/CD). L'id√©e est simple : **automatiser la g√©n√©ration de la documentation** √† chaque modification du code, et optionnellement la d√©ployer automatiquement sur un serveur web.

Dans cette section, nous allons voir :
- Pourquoi automatiser la g√©n√©ration de documentation
- Comment int√©grer Doxygen dans GitHub Actions (le plus populaire)
- Comment l'int√©grer dans GitLab CI
- Comment configurer Jenkins pour g√©n√©rer la doc
- Bonnes pratiques et pi√®ges √† √©viter

---

## Pourquoi int√©grer Doxygen dans le CI ?

### Probl√®mes de la g√©n√©ration manuelle

Sans automatisation :
- üòì Les d√©veloppeurs oublient de r√©g√©n√©rer la doc
- üì¶ La doc commit√©e dans Git grossit inutilement le d√©p√¥t
- ‚è∞ La doc devient rapidement obsol√®te
- üêõ Les erreurs Doxygen (warnings) passent inaper√ßues
- üîÑ Processus de release plus complexe

### Avantages de l'automatisation

Avec un pipeline CI/CD :
- ‚úÖ **Doc toujours √† jour** : G√©n√©r√©e automatiquement √† chaque push
- ‚úÖ **Pas de fichiers g√©n√©r√©s dans Git** : La doc est cr√©√©e √† la vol√©e
- ‚úÖ **D√©tection pr√©coce d'erreurs** : Les warnings Doxygen cassent le build
- ‚úÖ **D√©ploiement automatique** : Publication sur GitHub Pages, serveur web, etc.
- ‚úÖ **Versioning** : Possibilit√© de g√©n√©rer la doc pour chaque version/branche

---

## Concepts de base du CI/CD pour la documentation

### Qu'est-ce qu'un pipeline CI/CD ?

Un **pipeline** est une s√©rie d'√©tapes automatis√©es qui s'ex√©cutent √† chaque modification du code :

```
Commit ‚Üí Tests unitaires ‚Üí Compilation ‚Üí G√©n√©ration doc ‚Üí D√©ploiement
```

Pour la documentation, un pipeline typique ressemble √† :

```
1. D√©clencheur (push, pull request, tag)
   ‚Üì
2. Installation de Doxygen et d√©pendances
   ‚Üì
3. G√©n√©ration de la documentation (HTML/PDF)
   ‚Üì
4. V√©rification (warnings, erreurs)
   ‚Üì
5. D√©ploiement (GitHub Pages, serveur, artifact)
```

### Concepts cl√©s

- **Job** : Une t√¢che unique (ex: "g√©n√©rer la doc HTML")
- **Step** : Une √©tape dans un job (ex: "installer Doxygen")
- **Artifact** : Fichier produit par le pipeline (ex: la doc g√©n√©r√©e)
- **Trigger** : √âv√©nement qui d√©clenche le pipeline (push, PR, tag)
- **Runner** : Machine qui ex√©cute le pipeline (serveur GitHub, GitLab, etc.)

---

## Int√©gration avec GitHub Actions

GitHub Actions est le syst√®me CI/CD natif de GitHub. C'est gratuit pour les projets publics et offre 2000 minutes/mois pour les projets priv√©s.

### Structure d'un workflow GitHub Actions

Les workflows sont d√©finis dans `.github/workflows/` √† la racine du projet :

```
mon-projet/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ documentation.yml    # Notre workflow
‚îú‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ include/
‚îú‚îÄ‚îÄ Doxyfile
‚îî‚îÄ‚îÄ README.md
```

### Workflow minimal : G√©n√©ration seule

Cr√©ez `.github/workflows/documentation.yml` :

```yaml
name: Documentation

# Quand ex√©cuter ce workflow
on:
  push:
    branches: [ main, develop ]  # √Ä chaque push sur main ou develop
  pull_request:
    branches: [ main ]           # √Ä chaque PR vers main

jobs:
  build-docs:
    name: G√©n√©rer la documentation
    runs-on: ubuntu-latest       # Machine virtuelle Ubuntu

    steps:
      # 1. R√©cup√©rer le code source
      - name: Checkout du code
        uses: actions/checkout@v4

      # 2. Installer Doxygen
      - name: Installation de Doxygen
        run: sudo apt-get update && sudo apt-get install -y doxygen graphviz

      # 3. G√©n√©rer la documentation
      - name: G√©n√©ration avec Doxygen
        run: doxygen Doxyfile

      # 4. V√©rifier qu'il n'y a pas d'erreurs
      - name: V√©rification des warnings
        run: |
          if grep -q "warning" doxygen.log; then
            echo "‚ö†Ô∏è Des warnings Doxygen ont √©t√© d√©tect√©s !"
            cat doxygen.log
            exit 1
          fi
```

**Explications** :
- `on:` d√©finit quand le workflow s'ex√©cute (ici, √† chaque push/PR)
- `runs-on: ubuntu-latest` utilise une machine Ubuntu fournie par GitHub
- `uses: actions/checkout@v4` r√©cup√®re le code du d√©p√¥t
- `run:` ex√©cute des commandes bash classiques

### Workflow avec d√©ploiement GitHub Pages

Voici un workflow complet qui g√©n√®re ET publie la doc sur GitHub Pages :

```yaml
name: Documentation

on:
  push:
    branches: [ main ]

# Permissions n√©cessaires pour d√©ployer sur GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    name: G√©n√©rer et d√©ployer la documentation
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout du code
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Installation des outils
      - name: Installation de Doxygen et Graphviz
        run: |
          sudo apt-get update
          sudo apt-get install -y doxygen graphviz

      # 3. G√©n√©ration de la doc
      - name: G√©n√©ration Doxygen
        run: |
          doxygen Doxyfile
          # Cr√©er un fichier .nojekyll pour GitHub Pages
          touch docs/html/.nojekyll

      # 4. Uploader la doc g√©n√©r√©e comme artifact
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/html

      # 5. D√©ployer sur GitHub Pages
      - name: D√©ploiement sur GitHub Pages
        uses: actions/deploy-pages@v4
```

**Configuration GitHub Pages** :
1. Allez dans **Settings** ‚Üí **Pages** de votre d√©p√¥t GitHub
2. S√©lectionnez **GitHub Actions** comme source (pas "Deploy from branch")
3. Sauvegardez

Votre doc sera accessible √† : `https://votre-nom.github.io/votre-projet/`

### Workflow avanc√© : HTML + PDF avec cache

```yaml
name: Documentation compl√®te

on:
  push:
    branches: [ main ]
    tags: [ 'v*' ]  # Aussi sur les tags de version

jobs:
  documentation:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Cache pour acc√©l√©rer les builds
      - name: Cache des packages apt
        uses: actions/cache@v4
        with:
          path: /var/cache/apt
          key: ${{ runner.os }}-apt-${{ hashFiles('**/Doxyfile') }}

      # Installation compl√®te (Doxygen + LaTeX pour PDF)
      - name: Installation des d√©pendances
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            doxygen \
            graphviz \
            texlive-latex-base \
            texlive-latex-extra \
            texlive-fonts-recommended

      # G√©n√©ration HTML
      - name: G√©n√©ration HTML
        run: |
          doxygen Doxyfile
          touch docs/html/.nojekyll

      # G√©n√©ration PDF
      - name: G√©n√©ration PDF
        run: |
          cd docs/latex
          make
          cd ../..
          cp docs/latex/refman.pdf docs/documentation.pdf

      # V√©rification des warnings (optionnel, peut √™tre strict)
      - name: V√©rification qualit√©
        run: |
          # Compter les warnings
          WARNINGS=$(doxygen Doxyfile 2>&1 | grep -c "warning" || true)
          echo "Nombre de warnings : $WARNINGS"
          if [ $WARNINGS -gt 10 ]; then
            echo "‚ùå Trop de warnings Doxygen ($WARNINGS) !"
            exit 1
          fi

      # Upload des artifacts (HTML + PDF)
      - name: Upload documentation HTML
        uses: actions/upload-artifact@v4
        with:
          name: documentation-html
          path: docs/html/
          retention-days: 30

      - name: Upload documentation PDF
        uses: actions/upload-artifact@v4
        with:
          name: documentation-pdf
          path: docs/documentation.pdf
          retention-days: 30

      # D√©ploiement GitHub Pages
      - name: Upload vers Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/html

      - name: D√©ploiement Pages
        uses: actions/deploy-pages@v4
```

**Note sur les artifacts** : Les fichiers upload√©s via `actions/upload-artifact` sont t√©l√©chargeables depuis l'interface GitHub (onglet Actions ‚Üí Run ‚Üí Artifacts). Pratique pour r√©cup√©rer le PDF !

---

## Int√©gration avec GitLab CI

GitLab CI/CD est int√©gr√© nativement √† GitLab. La configuration se fait via un fichier `.gitlab-ci.yml` √† la racine du projet.

### Pipeline minimal

Cr√©ez `.gitlab-ci.yml` :

```yaml
# D√©finir les √©tapes du pipeline
stages:
  - build
  - deploy

# Job de g√©n√©ration de la doc
generate_docs:
  stage: build
  image: ubuntu:latest  # Image Docker √† utiliser

  before_script:
    # Installation des d√©pendances
    - apt-get update -qq
    - apt-get install -y doxygen graphviz

  script:
    # G√©n√©ration de la documentation
    - doxygen Doxyfile

  artifacts:
    # Conserver la doc g√©n√©r√©e
    paths:
      - docs/html/
    expire_in: 1 week

  only:
    - main        # Ex√©cuter seulement sur main
    - develop     # et develop
```

### Pipeline avec d√©ploiement GitLab Pages

GitLab Pages utilise un job sp√©cial nomm√© `pages` :

```yaml
stages:
  - build
  - deploy

# Job de build
build_docs:
  stage: build
  image: ubuntu:latest

  before_script:
    - apt-get update -qq
    - apt-get install -y doxygen graphviz

  script:
    - doxygen Doxyfile

  artifacts:
    paths:
      - docs/html/
    expire_in: 1 day

  only:
    - main

# Job de d√©ploiement sur GitLab Pages
pages:
  stage: deploy

  dependencies:
    - build_docs  # R√©cup√©rer les artifacts du job pr√©c√©dent

  script:
    # GitLab Pages attend les fichiers dans un dossier "public"
    - mv docs/html public

  artifacts:
    paths:
      - public

  only:
    - main
```

**Configuration GitLab Pages** :
1. Dans **Settings** ‚Üí **Pages**, activez GitLab Pages
2. Votre doc sera accessible √† : `https://votre-nom.gitlab.io/votre-projet/`

### Pipeline avec g√©n√©ration PDF

```yaml
stages:
  - build
  - test
  - deploy

variables:
  # D√©sactiver les messages interactifs apt
  DEBIAN_FRONTEND: noninteractive

build_html:
  stage: build
  image: ubuntu:latest

  before_script:
    - apt-get update -qq
    - apt-get install -y doxygen graphviz

  script:
    - doxygen Doxyfile

  artifacts:
    paths:
      - docs/html/
    expire_in: 1 week

build_pdf:
  stage: build
  image: ubuntu:latest

  before_script:
    - apt-get update -qq
    - apt-get install -y doxygen graphviz texlive-latex-base texlive-latex-extra

  script:
    - doxygen Doxyfile
    - cd docs/latex && make && cd ../..
    - cp docs/latex/refman.pdf docs/documentation.pdf

  artifacts:
    paths:
      - docs/documentation.pdf
    expire_in: 1 week

# V√©rifier la qualit√© de la doc
check_warnings:
  stage: test
  image: ubuntu:latest

  before_script:
    - apt-get update -qq && apt-get install -y doxygen

  script:
    - doxygen Doxyfile 2>&1 | tee doxygen.log
    - |
      if grep -q "warning:" doxygen.log; then
        echo "‚ö†Ô∏è Warnings d√©tect√©s !"
        grep "warning:" doxygen.log
        exit 1
      fi

  allow_failure: true  # Ne pas bloquer le pipeline si warnings

pages:
  stage: deploy
  dependencies:
    - build_html

  script:
    - mv docs/html public

  artifacts:
    paths:
      - public

  only:
    - main
```

---

## Int√©gration avec Jenkins

Jenkins est une solution auto-h√©berg√©e populaire dans les entreprises.

### Pipeline Jenkinsfile d√©claratif

Cr√©ez un `Jenkinsfile` √† la racine du projet :

```groovy
pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                // Jenkins fait le checkout automatiquement
                echo 'Code r√©cup√©r√©'
            }
        }

        stage('Installation') {
            steps {
                sh '''
                    sudo apt-get update
                    sudo apt-get install -y doxygen graphviz
                '''
            }
        }

        stage('G√©n√©ration Documentation') {
            steps {
                sh 'doxygen Doxyfile'
            }
        }

        stage('V√©rification') {
            steps {
                sh '''
                    if grep -q "warning" doxygen_warnings.log; then
                        echo "Warnings d√©tect√©s"
                        cat doxygen_warnings.log
                        exit 1
                    fi
                '''
            }
        }

        stage('Archivage') {
            steps {
                // Archiver la doc g√©n√©r√©e
                archiveArtifacts artifacts: 'docs/html/**', allowEmptyArchive: false
                archiveArtifacts artifacts: 'docs/latex/refman.pdf', allowEmptyArchive: true
            }
        }

        stage('Publication') {
            when {
                branch 'main'  // Seulement sur la branche main
            }
            steps {
                // Publier sur un serveur web (exemple avec rsync)
                sh '''
                    rsync -avz --delete docs/html/ \
                        user@serveur.com:/var/www/html/doc-projet/
                '''
            }
        }
    }

    post {
        success {
            echo '‚úÖ Documentation g√©n√©r√©e avec succ√®s !'
            // Envoyer une notification (email, Slack, etc.)
        }
        failure {
            echo '‚ùå √âchec de la g√©n√©ration de documentation'
        }
    }
}
```

### Configuration Jenkins

1. **Cr√©er un nouveau job** : New Item ‚Üí Pipeline
2. **Configurer le SCM** : Pointer vers votre d√©p√¥t Git
3. **Pipeline script** : S√©lectionner "Pipeline script from SCM"
4. **Script Path** : `Jenkinsfile`
5. **Triggers** : Cocher "Poll SCM" avec `H/5 * * * *` (v√©rifier toutes les 5 min)

---

## Gestion des versions de documentation

### Documentation par branche

Il est courant de g√©n√©rer diff√©rentes versions de la doc pour diff√©rentes branches :

**GitHub Actions - Multi-versions** :

```yaml
name: Documentation multi-versions

on:
  push:
    branches: [ main, develop, 'release/*' ]

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Installation Doxygen
        run: sudo apt-get update && sudo apt-get install -y doxygen graphviz

      - name: G√©n√©ration
        run: doxygen Doxyfile

      # D√©ployer dans un sous-dossier selon la branche
      - name: D√©ploiement par branche
        run: |
          BRANCH_NAME=${GITHUB_REF##*/}
          mkdir -p deploy/$BRANCH_NAME
          cp -r docs/html/* deploy/$BRANCH_NAME/

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: deploy

      - name: Deploy
        uses: actions/deploy-pages@v4
```

R√©sultat :
- `https://user.github.io/projet/main/` ‚Üí Doc de la branche main
- `https://user.github.io/projet/develop/` ‚Üí Doc de develop
- `https://user.github.io/projet/release-1.0/` ‚Üí Doc de release/1.0

### Documentation par tag (releases)

Pour g√©n√©rer la doc uniquement sur les versions officielles :

```yaml
on:
  push:
    tags:
      - 'v*.*.*'  # v1.0.0, v2.1.3, etc.

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: R√©cup√©rer le num√©ro de version
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Installation et g√©n√©ration
        run: |
          sudo apt-get update && sudo apt-get install -y doxygen graphviz
          # Mettre le num√©ro de version dans le Doxyfile
          sed -i "s/PROJECT_NUMBER.*/PROJECT_NUMBER = ${{ steps.version.outputs.VERSION }}/" Doxyfile
          doxygen Doxyfile

      # Cr√©er une release GitHub avec la doc en attachment
      - name: Cr√©er une release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            docs/documentation.pdf
          body: "Documentation pour ${{ steps.version.outputs.VERSION }}"
```

---

## Optimisation des pipelines

### 1. Utiliser un cache

Les installations de packages (Doxygen, LaTeX) sont lentes. Utilisez un cache :

**GitHub Actions** :
```yaml
- name: Cache apt packages
  uses: actions/cache@v4
  with:
    path: /var/cache/apt/archives
    key: ${{ runner.os }}-apt-doxygen
```

**GitLab CI** :
```yaml
cache:
  paths:
    - apt-cache/
  key: apt-doxygen

before_script:
  - export APT_CACHE_DIR=`pwd`/apt-cache && mkdir -pv $APT_CACHE_DIR
  - apt-get -o dir::cache::archives="$APT_CACHE_DIR" update
```

### 2. Utiliser des images Docker pr√©construites

Au lieu d'installer Doxygen √† chaque fois, utilisez une image Docker qui l'a d√©j√† :

```yaml
jobs:
  docs:
    runs-on: ubuntu-latest
    container:
      image: doxygen/doxygen:1.9.8  # Image officielle Doxygen

    steps:
      - uses: actions/checkout@v4

      # Pas besoin d'installer Doxygen !
      - name: G√©n√©ration
        run: doxygen Doxyfile
```

### 3. Ex√©cution conditionnelle

Ne g√©n√©rer la doc que si des fichiers source ont chang√© :

```yaml
on:
  push:
    paths:
      - 'src/**'
      - 'include/**'
      - 'Doxyfile'
      - '.github/workflows/documentation.yml'
```

---

## Notifications et rapports

### Envoyer un email en cas d'√©chec

**Jenkins** :
```groovy
post {
    failure {
        emailext(
            subject: "‚ùå Documentation build failed",
            body: "La g√©n√©ration de la doc a √©chou√©. Voir ${BUILD_URL}",
            to: "dev-team@example.com"
        )
    }
}
```

**GitHub Actions avec action-send-mail** :
```yaml
- name: Envoyer email si √©chec
  if: failure()
  uses: dawidd6/action-send-mail@v3
  with:
    server_address: smtp.gmail.com
    server_port: 465
    username: ${{ secrets.EMAIL_USERNAME }}
    password: ${{ secrets.EMAIL_PASSWORD }}
    subject: "Documentation build failed"
    to: dev-team@example.com
    from: CI/CD Bot
    body: Le build de la doc a √©chou√©. V√©rifiez les logs.
```

### Notification Slack

**GitHub Actions** :
```yaml
- name: Notification Slack
  if: always()
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    text: 'Documentation g√©n√©r√©e avec succ√®s !'
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

---

## Gestion des erreurs et warnings

### Traiter les warnings comme des erreurs

Dans votre `Doxyfile` :

```bash
WARN_AS_ERROR          = YES
```

Cela fait √©chouer Doxygen (et donc le pipeline) si des warnings sont d√©tect√©s.

### Autoriser certains warnings

Si vous voulez √™tre strict mais tol√©rer quelques warnings connus :

```yaml
- name: V√©rification avec tol√©rance
  run: |
    doxygen Doxyfile 2>&1 | tee doxygen.log
    WARNINGS=$(grep -c "warning:" doxygen.log || true)
    echo "Warnings trouv√©s : $WARNINGS"
    MAX_WARNINGS=5
    if [ $WARNINGS -gt $MAX_WARNINGS ]; then
      echo "‚ùå Trop de warnings ($WARNINGS > $MAX_WARNINGS)"
      exit 1
    fi
```

### G√©n√©ration d'un rapport de qualit√©

```yaml
- name: Rapport de qualit√©
  run: |
    doxygen Doxyfile 2>&1 | tee doxygen_full.log

    # Extraire les statistiques
    FUNCTIONS=$(grep -c "Generating docs for function" doxygen_full.log || echo 0)
    WARNINGS=$(grep -c "warning:" doxygen_full.log || echo 0)

    # Cr√©er un fichier de rapport
    cat > rapport.txt <<EOF
    üìä Rapport de g√©n√©ration Doxygen
    ================================
    Fonctions document√©es : $FUNCTIONS
    Warnings d√©tect√©s     : $WARNINGS
    Date                  : $(date)
    Commit                : $GITHUB_SHA
    EOF

    cat rapport.txt
```

---

## S√©curit√© et bonnes pratiques

### 1. Ne jamais commiter la doc g√©n√©r√©e

Ajoutez √† votre `.gitignore` :

```gitignore
# Documentation g√©n√©r√©e
docs/html/
docs/latex/
docs/*.pdf
doxygen.log
```

La doc doit √™tre g√©n√©r√©e par le CI, pas versionn√©e dans Git.

### 2. Prot√©ger les secrets

Si vous d√©ployez sur un serveur externe, utilisez des secrets :

**GitHub Actions** :
```yaml
- name: D√©ploiement SSH
  env:
    SSH_KEY: ${{ secrets.DEPLOY_SSH_KEY }}
  run: |
    echo "$SSH_KEY" > deploy_key
    chmod 600 deploy_key
    rsync -avz -e "ssh -i deploy_key" docs/html/ user@server:/var/www/
```

Ajoutez `DEPLOY_SSH_KEY` dans **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**.

### 3. Limiter les permissions

Donnez au pipeline seulement les permissions n√©cessaires :

```yaml
permissions:
  contents: read      # Lire le code
  pages: write        # √âcrire sur Pages
  id-token: write     # Authentification
  # Pas de permissions d'√©criture sur le d√©p√¥t
```

### 4. Versionner le Doxyfile

Le `Doxyfile` doit √™tre dans Git. Ajoutez un commentaire d'ent√™te :

```bash
# Doxyfile - Configuration Doxygen
# G√©n√©r√© le 2025-01-15
# Ne pas modifier manuellement les chemins OUTPUT_DIRECTORY
```

---

## D√©bogage des pipelines

### Probl√®me : Doxygen ne trouve pas les fichiers

**Sympt√¥me** : "warning: no output generated"

**Solution** : V√©rifiez les chemins dans le `Doxyfile`. Dans les CI, vous √™tes √† la racine du projet :

```bash
INPUT                  = ./src ./include
```

Non pas :

```bash
INPUT                  = src/ include/  # Peut √©chouer selon le CI
```

### Probl√®me : Permissions insuffisantes

**Sympt√¥me** : "Permission denied" lors de l'√©criture

**Solution** :
```yaml
- name: Fix permissions
  run: |
    mkdir -p docs
    chmod -R 755 docs
```

### Probl√®me : LaTeX manque de packages

**Sympt√¥me** : "! LaTeX Error: File `xxx.sty' not found"

**Solution** : Installez le package Tex correspondant ou utilisez `texlive-full` :

```yaml
- name: Installation LaTeX compl√®te
  run: sudo apt-get install -y texlive-full
```

### Probl√®me : Le pipeline est trop lent

**Sympt√¥mes** : G√©n√©ration prend >10 minutes

**Solutions** :
1. Utilisez un cache (voir section Optimisation)
2. D√©sactivez la g√©n√©ration de graphes complexes :
   ```bash
   HAVE_DOT               = NO
   ```
3. Limitez la profondeur des call graphs :
   ```bash
   MAX_DOT_GRAPH_DEPTH    = 2
   ```

### D√©boguer en local

Reproduisez le pipeline localement avec Docker :

```bash
docker run -it --rm -v $(pwd):/workspace ubuntu:latest bash
cd /workspace
apt-get update && apt-get install -y doxygen
doxygen Doxyfile
```

---

## Exemples complets comment√©s

### Exemple 1 : GitHub Actions minimaliste

```yaml
# .github/workflows/docs.yml
name: Docs

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: sudo apt-get update && sudo apt-get install -y doxygen
      - run: doxygen
      - uses: actions/upload-pages-artifact@v3
        with:
          path: docs/html
      - uses: actions/deploy-pages@v4
```

**5 lignes utiles** : Checkout, install, generate, upload, deploy.

### Exemple 2 : GitLab CI avec PDF et Pages

```yaml
# .gitlab-ci.yml
stages:
  - build
  - deploy

build:
  stage: build
  image: ubuntu:latest
  before_script:
    - apt-get update && apt-get install -y doxygen graphviz texlive-latex-base texlive-latex-extra
  script:
    - doxygen
    - cd docs/latex && make && cd ../..
  artifacts:
    paths:
      - docs/html/
      - docs/latex/refman.pdf

pages:
  stage: deploy
  dependencies: [build]
  script:
    - mv docs/html public
  artifacts:
    paths: [public]
  only: [main]
```

### Exemple 3 : Jenkins avec publication HTTP

```groovy
// Jenkinsfile
pipeline {
    agent any
    stages {
        stage('Build Docs') {
            steps {
                sh 'doxygen'
            }
        }
        stage('Deploy') {
            when { branch 'main' }
            steps {
                sh 'rsync -avz docs/html/ jenkins@webserver:/var/www/docs/'
            }
        }
    }
}
```

---

## Checklist avant de d√©ployer en production

‚úÖ **Configuration** :
- [ ] `Doxyfile` versionn√© dans Git
- [ ] `.gitignore` contient `docs/html/` et `docs/latex/`
- [ ] `WARN_AS_ERROR = YES` (ou gestion des warnings)
- [ ] `PROJECT_NAME` et `PROJECT_NUMBER` corrects

‚úÖ **Pipeline** :
- [ ] S'ex√©cute sur les bonnes branches (main, develop, tags)
- [ ] Installation des d√©pendances (Doxygen, Graphviz, LaTeX si PDF)
- [ ] G√©n√©ration de la doc r√©ussit
- [ ] V√©rification des warnings
- [ ] Artifacts ou d√©ploiement configur√©

‚úÖ **Tests** :
- [ ] Pipeline test√© sur une PR de test
- [ ] Documentation accessible apr√®s d√©ploiement
- [ ] Liens internes fonctionnels
- [ ] Graphes visibles (si `HAVE_DOT = YES`)

‚úÖ **S√©curit√©** :
- [ ] Secrets utilis√©s pour les cl√©s SSH/tokens
- [ ] Permissions minimales accord√©es
- [ ] Pas de donn√©es sensibles dans les logs

---

## Aller plus loin

### Documentation multi-langues

G√©n√©rez la doc en plusieurs langues :

```yaml
- name: Doc FR
  run: |
    sed -i 's/OUTPUT_LANGUAGE.*/OUTPUT_LANGUAGE = French/' Doxyfile
    sed -i 's/HTML_OUTPUT.*/HTML_OUTPUT = html\/fr/' Doxyfile
    doxygen

- name: Doc EN
  run: |
    sed -i 's/OUTPUT_LANGUAGE.*/OUTPUT_LANGUAGE = English/' Doxyfile
    sed -i 's/HTML_OUTPUT.*/HTML_OUTPUT = html\/en/' Doxyfile
    doxygen
```

### Int√©gration avec Codecov

Combinez couverture de tests et doc :

```yaml
- name: Couverture de documentation
  run: |
    FUNCS_TOTAL=$(grep -r "^[a-z].*(" src/ | wc -l)
    FUNCS_DOC=$(grep -c "@brief" src/**/*.c)
    COVERAGE=$((FUNCS_DOC * 100 / FUNCS_TOTAL))
    echo "Documentation coverage: $COVERAGE%"
    if [ $COVERAGE -lt 80 ]; then
      echo "‚ùå Couverture insuffisante (<80%)"
      exit 1
    fi
```

### Badge de documentation

Ajoutez un badge dans votre `README.md` :

**GitHub Actions** :
```markdown
![Documentation](https://github.com/user/projet/actions/workflows/docs.yml/badge.svg)
```

**GitLab CI** :
```markdown
![Documentation](https://gitlab.com/user/projet/badges/main/pipeline.svg)
```

---

## R√©sum√©

L'int√©gration de Doxygen dans le CI/CD apporte :

1. ‚úÖ **Automatisation** : Doc g√©n√©r√©e √† chaque commit
2. ‚úÖ **Qualit√©** : D√©tection pr√©coce des warnings
3. ‚úÖ **Accessibilit√©** : D√©ploiement automatique sur Pages/serveur
4. ‚úÖ **Versioning** : Doc par branche/tag/version
5. ‚úÖ **Collaboration** : Tout le monde a acc√®s √† la doc √† jour

**Commandes essentielles** :

```bash
# GitHub Actions : .github/workflows/docs.yml
# GitLab CI    : .gitlab-ci.yml
# Jenkins      : Jenkinsfile
```

**Structure type** :
```
Checkout ‚Üí Install Doxygen ‚Üí Generate ‚Üí Check Warnings ‚Üí Deploy
```

Dans la section suivante (32.2), nous verrons comment r√©diger un bon **README et une documentation utilisateur** pour compl√©ter la documentation technique g√©n√©r√©e par Doxygen.

---

**Ressources compl√©mentaires** :
- GitHub Actions Docs : https://docs.github.com/en/actions
- GitLab CI/CD : https://docs.gitlab.com/ee/ci/
- Jenkins Pipeline : https://www.jenkins.io/doc/book/pipeline/
- Doxygen CI Examples : https://github.com/topics/doxygen-documentation

‚è≠Ô∏è [README et documentation utilisateur](/32-documentation-maintenance/02-readme-documentation.md)
