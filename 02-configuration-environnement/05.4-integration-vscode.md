üîù Retour au [Sommaire](/SOMMAIRE.md)

# 2.5.4 Int√©gration VS Code et onboarding

## Introduction

Vous avez maintenant un DevContainer correctement configur√© avec tous les outils n√©cessaires (GCC, GDB, CMake, Valgrind). Mais comment faire pour que cette configuration soit **facilement utilisable** par vous-m√™me et par d'autres personnes ?

Cette section couvre :
- L'installation de l'extension Dev Containers dans VS Code
- L'exp√©rience utilisateur lors de l'ouverture d'un projet avec DevContainer
- Comment faciliter l'**onboarding** (l'int√©gration de nouveaux d√©veloppeurs)
- Les bonnes pratiques pour une adoption r√©ussie en √©quipe

**Analogie :** Vous avez construit une belle maison (le DevContainer). Maintenant, il faut cr√©er un chemin d'acc√®s facile, installer une sonnette claire, et pr√©parer un guide d'accueil pour les visiteurs.

---

## Pr√©requis pour utiliser les DevContainers

### Sur la machine de chaque d√©veloppeur

Pour utiliser un DevContainer, chaque d√©veloppeur doit avoir :

1. **Docker** install√© et fonctionnel
2. **VS Code** install√©
3. **L'extension Dev Containers** install√©e dans VS Code

C'est tout ! Le reste est g√©r√© automatiquement par le DevContainer.

### Installation de Docker

#### Sur Ubuntu

```bash
# Installer Docker
sudo apt-get update
sudo apt-get install -y docker.io

# Ajouter l'utilisateur au groupe docker (√©vite d'utiliser sudo)
sudo usermod -aG docker $USER

# Red√©marrer la session pour appliquer les changements
# (d√©connectez-vous et reconnectez-vous, ou red√©marrez)

# V√©rifier l'installation
docker --version
docker run hello-world
```

#### V√©rification

```bash
# Doit s'ex√©cuter sans sudo et sans erreur
docker ps
```

Si vous obtenez une erreur de permission, red√©marrez votre session ou votre ordinateur.

### Installation de l'extension Dev Containers

#### M√©thode 1 : Depuis VS Code

1. Ouvrez VS Code
2. Cliquez sur l'ic√¥ne Extensions (barre lat√©rale gauche) ou `Ctrl+Shift+X`
3. Recherchez "Dev Containers"
4. Installez l'extension **Dev Containers** par Microsoft (identifiant : `ms-vscode-remote.remote-containers`)

#### M√©thode 2 : Ligne de commande

```bash
code --install-extension ms-vscode-remote.remote-containers
```

#### M√©thode 3 : Pack complet Remote Development

Microsoft propose un pack qui inclut plusieurs extensions utiles :

```bash
code --install-extension ms-vscode-remote.vscode-remote-extensionpack
```

Ce pack inclut :
- **Dev Containers** : Pour les conteneurs de d√©veloppement
- **Remote - SSH** : Pour d√©velopper sur des serveurs distants
- **WSL** : Pour d√©velopper dans Windows Subsystem for Linux

### V√©rification de l'installation

Apr√®s installation, vous devriez voir :
- Une nouvelle ic√¥ne dans la barre lat√©rale gauche (ic√¥ne avec `><`)
- Une nouvelle zone dans la barre de statut en bas √† gauche (coin vert ou bleu)

---

## Premi√®re ouverture d'un DevContainer

### Sc√©nario : Vous clonez un projet existant

Imaginons que vous clonez un projet qui contient d√©j√† une configuration DevContainer.

#### √âtape 1 : Cloner le projet

```bash
git clone https://github.com/exemple/projet-c.git
cd projet-c
```

#### √âtape 2 : Ouvrir dans VS Code

```bash
code .
```

#### √âtape 3 : VS Code d√©tecte le DevContainer

Si le projet contient un dossier `.devcontainer/`, VS Code affiche automatiquement une notification :

```
Folder contains a Dev Container configuration file.
Reopen folder in container?

[Reopen in Container]  [Don't Show Again]
```

**Cliquez sur "Reopen in Container".**

#### √âtape 4 : Construction du conteneur

VS Code :
1. T√©l√©charge l'image Docker de base (si pas d√©j√† pr√©sente)
2. Construit le conteneur selon la configuration
3. Ex√©cute les commandes `postCreateCommand`
4. Installe les extensions VS Code dans le conteneur
5. Se connecte au conteneur

**Premi√®re fois :** Peut prendre 2-10 minutes selon la connexion internet et la complexit√© du conteneur.

**Fois suivantes :** Quelques secondes seulement (le conteneur existe d√©j√†).

#### √âtape 5 : Vous √™tes pr√™t !

Une fois connect√© :
- La barre de statut en bas √† gauche affiche le nom du conteneur
- Le terminal int√©gr√© s'ex√©cute dans le conteneur
- Toutes les extensions sont install√©es
- Vous pouvez compiler, d√©boguer, etc.

### Indicateurs visuels dans VS Code

#### Barre de statut

Quand vous √™tes dans un DevContainer, la barre de statut (en bas √† gauche) affiche :

```
[Dev Container: Nom du conteneur]
```

Avec une ic√¥ne distinctive (g√©n√©ralement verte ou bleue).

**Cliquez dessus** pour acc√©der aux options :
- Rouvrir localement
- Reconstruire le conteneur
- Voir les logs
- etc.

#### Explorateur de fichiers

L'explorateur de fichiers montre les fichiers du projet, mais ils sont acc√©d√©s depuis le conteneur.

#### Terminal

Le terminal int√©gr√© (`Ctrl+` `) s'ex√©cute **dans le conteneur**, pas sur votre machine h√¥te.

```bash
# Dans le terminal VS Code (dans le conteneur)
whoami
# vscode

cat /etc/os-release
# Ubuntu 22.04...

gcc --version
# gcc (Ubuntu 11.4.0...) 11.4.0
```

---

## Commandes importantes de l'extension Dev Containers

Acc√©dez √† toutes les commandes via `Ctrl+Shift+P` puis tapez "Dev Containers".

### Commandes principales

| Commande | Description |
|----------|-------------|
| **Reopen in Container** | Ouvre le dossier actuel dans un DevContainer |
| **Reopen Folder Locally** | Retourne √† l'ouverture locale (hors conteneur) |
| **Rebuild Container** | Reconstruit le conteneur from scratch |
| **Rebuild and Reopen in Container** | Reconstruit et rouvre |
| **Open Folder in Container...** | Ouvre un autre dossier dans un conteneur |
| **Clone Repository in Container Volume** | Clone un repo directement dans un conteneur |

### Commandes de diagnostic

| Commande | Description |
|----------|-------------|
| **Show Container Log** | Affiche les logs de cr√©ation du conteneur |
| **Inspect Container** | Affiche les d√©tails du conteneur Docker |
| **Open Container Configuration File** | Ouvre le `devcontainer.json` |

### Raccourcis pratiques

Pour un acc√®s rapide, cliquez sur l'ic√¥ne verte/bleue en bas √† gauche de VS Code. Un menu contextuel appara√Æt avec les options principales.

---

## Configurer l'ouverture automatique

### Param√®tre recommand√©

Pour que VS Code propose syst√©matiquement d'ouvrir les DevContainers, configurez ce param√®tre :

Dans vos settings VS Code (`Ctrl+,` ‚Üí recherchez "dev containers") :

```json
{
    "dev.containers.reopenInContainer": "prompt"
}
```

**Options disponibles :**

| Valeur | Comportement |
|--------|--------------|
| `"prompt"` | Demande √† chaque fois (recommand√©) |
| `"always"` | Ouvre toujours dans le conteneur |
| `"never"` | N'ouvre jamais automatiquement |

### Forcer l'ouverture depuis la ligne de commande

```bash
# Ouvrir un projet directement dans son DevContainer
code --folder-uri vscode-remote://dev-container+$(printf '%s' '/chemin/vers/projet' | xxd -p)/workspace
```

C'est complexe, donc la m√©thode simple reste :
```bash
code /chemin/vers/projet
# Puis cliquer sur "Reopen in Container"
```

---

## Faciliter l'onboarding des nouveaux d√©veloppeurs

L'**onboarding** est le processus d'int√©gration d'un nouveau membre dans l'√©quipe. Avec les DevContainers, cela peut √™tre r√©duit de plusieurs jours √† quelques minutes.

### Cr√©er une documentation claire

#### README.md du projet

```markdown
# Mon Projet C

## üöÄ D√©marrage rapide

### Pr√©requis

1. **Docker** : [Instructions d'installation](https://docs.docker.com/get-docker/)
2. **VS Code** : [T√©l√©charger](https://code.visualstudio.com/)
3. **Extension Dev Containers** : Installer depuis VS Code (`ms-vscode-remote.remote-containers`)

### Installation

```bash
# 1. Cloner le projet
git clone https://github.com/votre-org/projet-c.git
cd projet-c

# 2. Ouvrir dans VS Code
code .

# 3. Quand VS Code demande "Reopen in Container?", cliquez "Oui"
#    (Ou: Ctrl+Shift+P ‚Üí "Dev Containers: Reopen in Container")

# 4. Attendez la construction du conteneur (2-5 min la premi√®re fois)

# 5. C'est pr√™t ! Vous pouvez compiler et ex√©cuter.
```

### Compiler et ex√©cuter

```bash
# Option 1 : Avec CMake (recommand√©)
mkdir -p build && cd build
cmake ..
make
./mon_programme

# Option 2 : Raccourci VS Code
# Ctrl+Shift+B pour compiler
# F5 pour d√©boguer
```

### V√©rifier l'installation

```bash
# Dans le terminal VS Code (dans le conteneur)
gcc --version      # Doit afficher GCC 11.x
cmake --version    # Doit afficher CMake 3.x
valgrind --version # Doit afficher Valgrind 3.x
```

## üìÅ Structure du projet

```
projet-c/
‚îú‚îÄ‚îÄ .devcontainer/     # Configuration DevContainer
‚îú‚îÄ‚îÄ .vscode/           # Configuration VS Code
‚îú‚îÄ‚îÄ src/               # Code source
‚îú‚îÄ‚îÄ include/           # Headers
‚îú‚îÄ‚îÄ tests/             # Tests unitaires
‚îú‚îÄ‚îÄ build/             # Fichiers compil√©s (ignor√© par Git)
‚îî‚îÄ‚îÄ CMakeLists.txt     # Configuration CMake
```

## üõ†Ô∏è Commandes utiles

| Action | Commande |
|--------|----------|
| Compiler | `Ctrl+Shift+B` ou `cmake --build build` |
| D√©boguer | `F5` |
| Tester | `cd build && ctest` |
| Valgrind | `valgrind --leak-check=full ./build/programme` |
| Formater | `Ctrl+Shift+I` |

## ‚ùì Probl√®mes fr√©quents

### Le conteneur ne d√©marre pas

1. V√©rifiez que Docker fonctionne : `docker ps`
2. Reconstruisez : `Ctrl+Shift+P` ‚Üí "Dev Containers: Rebuild Container"

### Permission denied

Sur Linux, ajoutez votre utilisateur au groupe Docker :
```bash
sudo usermod -aG docker $USER
# Puis d√©connectez-vous et reconnectez-vous
```
```

### Fichier CONTRIBUTING.md

Cr√©ez un fichier `CONTRIBUTING.md` pour les contributeurs :

```markdown
# Guide de contribution

## Environnement de d√©veloppement

Ce projet utilise un **DevContainer** pour garantir un environnement coh√©rent.

### Configuration automatique

Tout l'environnement est configur√© automatiquement :
- ‚úÖ Compilateur (GCC 11)
- ‚úÖ D√©bogueur (GDB)
- ‚úÖ Build system (CMake)
- ‚úÖ Analyseur m√©moire (Valgrind)
- ‚úÖ Formateur de code (clang-format)
- ‚úÖ Extensions VS Code

**Vous n'avez rien √† installer manuellement** (sauf Docker et VS Code).

### √âtapes pour contribuer

1. **Fork** le projet sur GitHub
2. **Clonez** votre fork
3. **Ouvrez** dans VS Code avec le DevContainer
4. **Cr√©ez** une branche pour votre fonctionnalit√©
5. **D√©veloppez** et testez
6. **Soumettez** une Pull Request

### Standards de code

Le projet utilise clang-format pour le formatage automatique.
- Le code est format√© automatiquement √† la sauvegarde
- Style : LLVM avec indentation de 4 espaces
- Limite de colonnes : 80 caract√®res

### Tests

Avant de soumettre :
```bash
# Compiler
cmake --build build

# Ex√©cuter les tests
cd build && ctest --output-on-failure

# V√©rifier les fuites m√©moire
valgrind --leak-check=full ./build/mon_programme
```

### Checklist PR

- [ ] Le code compile sans warnings
- [ ] Les tests passent
- [ ] Valgrind ne d√©tecte pas de fuites
- [ ] Le code est format√© (automatique avec formatOnSave)
- [ ] La documentation est mise √† jour si n√©cessaire
```

### Fichier .devcontainer/README.md

Documentez la configuration du DevContainer elle-m√™me :

```markdown
# Configuration DevContainer

Ce dossier contient la configuration de l'environnement de d√©veloppement.

## Contenu

- `devcontainer.json` : Configuration principale du DevContainer
- `Dockerfile` : (Optionnel) Image Docker personnalis√©e

## Ce qui est install√©

| Outil | Version | Usage |
|-------|---------|-------|
| Ubuntu | 22.04 | Syst√®me de base |
| GCC | 11.x | Compilation |
| GDB | 12.x | D√©bogage |
| CMake | 3.22+ | Build system |
| Valgrind | 3.18+ | Analyse m√©moire |
| clang-format | 14+ | Formatage code |
| Git | Latest | Versionnement |

## Extensions VS Code incluses

- C/C++ (IntelliSense, d√©bogage)
- CMake Tools
- Error Lens
- GitLens
- etc.

## Modification

Si vous devez modifier l'environnement :

1. Modifiez `devcontainer.json`
2. Reconstruisez : `Ctrl+Shift+P` ‚Üí "Rebuild Container"
3. Testez que tout fonctionne
4. Commitez les changements

## Support

En cas de probl√®me :
1. Consultez les logs : `Ctrl+Shift+P` ‚Üí "Show Container Log"
2. Essayez de reconstruire : `Ctrl+Shift+P` ‚Üí "Rebuild Container"
3. Ouvrez une issue sur GitHub avec les logs
```

---

## Cr√©er un script d'onboarding

### Script de bienvenue

Cr√©ez `.devcontainer/welcome.sh` :

```bash
#!/bin/bash

# Script de bienvenue ex√©cut√© au premier d√©marrage

clear

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë                                                              ‚ïë"
echo "‚ïë   üéâ Bienvenue dans l'environnement de d√©veloppement !       ‚ïë"
echo "‚ïë                                                              ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""
echo "üìã Outils disponibles :"
echo "   ‚Ä¢ GCC $(gcc --version | head -1 | awk '{print $4}')"
echo "   ‚Ä¢ GDB $(gdb --version | head -1 | awk '{print $4}')"
echo "   ‚Ä¢ CMake $(cmake --version | head -1 | awk '{print $3}')"
echo "   ‚Ä¢ Valgrind $(valgrind --version | awk '{print $2}')"
echo ""
echo "üöÄ Commandes rapides :"
echo "   ‚Ä¢ Compiler     : Ctrl+Shift+B"
echo "   ‚Ä¢ D√©boguer     : F5"
echo "   ‚Ä¢ Terminal     : Ctrl+\`"
echo "   ‚Ä¢ Formater     : Ctrl+Shift+I"
echo ""
echo "üìÅ Structure du projet :"
echo "   ‚Ä¢ src/         : Code source"
echo "   ‚Ä¢ include/     : Headers"
echo "   ‚Ä¢ tests/       : Tests unitaires"
echo "   ‚Ä¢ build/       : Fichiers compil√©s"
echo ""
echo "üìö Documentation :"
echo "   ‚Ä¢ README.md           : Guide de d√©marrage"
echo "   ‚Ä¢ CONTRIBUTING.md     : Guide de contribution"
echo ""
echo "üí° Astuce : Tapez 'make help' pour voir les commandes disponibles"
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
```

### Int√©gration dans devcontainer.json

```json
{
    "postAttachCommand": "bash .devcontainer/welcome.sh"
}
```

Ce script s'affichera chaque fois que VS Code se connecte au conteneur.

### Version moins intrusive

Si vous pr√©f√©rez un message discret :

```json
{
    "postAttachCommand": "echo '‚úì Environnement pr√™t ! Tapez make help pour les commandes disponibles.'"
}
```

---

## G√©rer les diff√©rents niveaux d'utilisateurs

### Utilisateurs d√©butants

Pour les d√©butants, fournissez des **guides pas √† pas** avec captures d'√©cran.

#### Guide illustr√© (dans un Wiki ou documentation)

```markdown
## Installation pour d√©butants

### √âtape 1 : Installer Docker

[Capture d'√©cran de l'installation Docker]

1. T√©l√©chargez Docker Desktop depuis docker.com
2. Lancez l'installateur
3. Suivez les instructions √† l'√©cran
4. Red√©marrez votre ordinateur

### √âtape 2 : Installer VS Code

[Capture d'√©cran]

1. T√©l√©chargez VS Code depuis code.visualstudio.com
2. Installez-le

### √âtape 3 : Installer l'extension

[Capture d'√©cran de l'installation d'extension]

1. Ouvrez VS Code
2. Cliquez sur l'ic√¥ne des extensions (carr√© dans la barre de gauche)
3. Tapez "Dev Containers"
4. Cliquez sur "Install"

### √âtape 4 : Ouvrir le projet

[Capture d'√©cran]

1. Ouvrez un terminal
2. Tapez : git clone [URL]
3. Tapez : code [nom-du-projet]
4. Quand VS Code demande "Reopen in Container", cliquez "Oui"
5. Attendez quelques minutes
6. C'est pr√™t !
```

### Utilisateurs avanc√©s

Pour les utilisateurs avanc√©s, fournissez des informations techniques :

```markdown
## Notes techniques

### Configuration Docker

Le DevContainer utilise les options suivantes :
- `--cap-add=SYS_PTRACE` : Pour GDB
- `--security-opt seccomp=unconfined` : Pour le d√©bogage

### Performance

Pour am√©liorer les performances sur les gros projets :
- Utilisez un volume Docker pour le dossier build
- Activez BuildKit : `export DOCKER_BUILDKIT=1`

### Personnalisation

Vous pouvez ajouter vos propres extensions dans :
`.vscode/settings.json` (local, non commit√©)

Ou demander l'ajout d'extensions globales via PR sur `devcontainer.json`.
```

---

## Bonnes pratiques d'√©quipe

### 1. Un seul DevContainer par projet

√âvitez d'avoir plusieurs configurations concurrentes. Un seul `devcontainer.json` bien maintenu.

### 2. Versionnez le DevContainer avec le code

Le `devcontainer.json` doit **toujours** √™tre commit√© dans Git :

```bash
git add .devcontainer/
git commit -m "Add/Update DevContainer configuration"
```

Quand l'environnement √©volue, le code et la configuration √©voluent ensemble.

### 3. Testez les changements de configuration

Avant de commiter un changement de `devcontainer.json` :

```bash
# Supprimer le conteneur existant
# Ctrl+Shift+P ‚Üí "Dev Containers: Rebuild Container"

# V√©rifier que tout fonctionne
# - Compilation
# - Tests
# - D√©bogage
```

### 4. Communiquez les changements

Quand vous modifiez le DevContainer :

```markdown
## Changelog - DevContainer

### 2025-01-15
- Ajout de Valgrind
- Mise √† jour de GCC vers la version 12
- **Action requise** : Rebuild Container apr√®s pull
```

### 5. Utilisez des images stables

Pr√©f√©rez des images avec des versions sp√©cifiques :

```json
{
    "image": "mcr.microsoft.com/devcontainers/cpp:1-ubuntu-22.04"
}
```

Plut√¥t que :

```json
{
    "image": "mcr.microsoft.com/devcontainers/cpp:latest"
}
```

Les images `latest` peuvent changer et casser la reproductibilit√©.

### 6. Documentez les raisons des choix

Dans votre `devcontainer.json`, utilisez des commentaires :

```json
{
    "name": "Projet C",

    // Ubuntu 22.04 pour GCC 11 et glibc 2.35
    // N√©cessaire pour la compatibilit√© avec le serveur de production
    "image": "mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04",

    // Valgrind ajout√© pour la d√©tection de fuites (requis par la CI)
    "postCreateCommand": "apt-get update && apt-get install -y valgrind",

    // Options n√©cessaires pour GDB dans Docker
    "runArgs": [
        "--cap-add=SYS_PTRACE",
        "--security-opt", "seccomp=unconfined"
    ]
}
```

---

## G√©rer les pr√©f√©rences personnelles

Chaque d√©veloppeur peut avoir des pr√©f√©rences personnelles (th√®me, extensions suppl√©mentaires) sans affecter le DevContainer partag√©.

### Settings locaux (non commit√©s)

Cr√©ez `.vscode/settings.json` et ajoutez-le √† `.gitignore` :

```bash
echo ".vscode/settings.json" >> .gitignore
```

Chaque d√©veloppeur peut avoir ses propres settings :

```json
{
    "workbench.colorTheme": "Monokai",
    "editor.fontSize": 16,
    "terminal.integrated.fontSize": 14
}
```

### Extensions personnelles

Les extensions list√©es dans `devcontainer.json` sont install√©es pour tous.

Pour des extensions personnelles, installez-les manuellement apr√®s la cr√©ation du conteneur. Elles persisteront tant que le conteneur existe.

### Dotfiles personnalis√©s

VS Code permet d'injecter vos dotfiles personnels dans le conteneur.

Dans vos settings VS Code globaux :

```json
{
    "dotfiles.repository": "https://github.com/votre-username/dotfiles",
    "dotfiles.targetPath": "~/dotfiles",
    "dotfiles.installCommand": "install.sh"
}
```

Votre repository `dotfiles` peut contenir :
- `.bashrc` ou `.zshrc` personnalis√©
- `.gitconfig`
- Alias personnalis√©s
- etc.

---

## Automatiser l'onboarding avec des scripts

### Script d'installation complet

Cr√©ez un script `setup.sh` √† la racine du projet :

```bash
#!/bin/bash

# Script d'installation automatique
# Usage : curl -fsSL https://raw.githubusercontent.com/org/projet/main/setup.sh | bash

set -e

echo "üöÄ Installation de l'environnement de d√©veloppement"
echo ""

# V√©rifier Docker
if ! command -v docker &> /dev/null; then
    echo "‚ùå Docker n'est pas install√©."
    echo "   Installez Docker : https://docs.docker.com/get-docker/"
    exit 1
fi
echo "‚úì Docker d√©tect√© : $(docker --version)"

# V√©rifier VS Code
if ! command -v code &> /dev/null; then
    echo "‚ùå VS Code n'est pas install√© ou pas dans le PATH."
    echo "   Installez VS Code : https://code.visualstudio.com/"
    exit 1
fi
echo "‚úì VS Code d√©tect√© : $(code --version | head -1)"

# Installer l'extension Dev Containers
echo "üì¶ Installation de l'extension Dev Containers..."
code --install-extension ms-vscode-remote.remote-containers --force
echo "‚úì Extension install√©e"

# Cloner le projet (si pas d√©j√† fait)
PROJECT_DIR="projet-c"
if [ ! -d "$PROJECT_DIR" ]; then
    echo "üì• Clonage du projet..."
    git clone https://github.com/org/projet-c.git "$PROJECT_DIR"
fi

# Ouvrir dans VS Code
echo ""
echo "üéâ Installation termin√©e !"
echo ""
echo "Pour commencer :"
echo "  cd $PROJECT_DIR"
echo "  code ."
echo "  ‚Üí Cliquez sur 'Reopen in Container' quand demand√©"
echo ""
```

### Utilisation

Les nouveaux d√©veloppeurs peuvent ex√©cuter :

```bash
curl -fsSL https://raw.githubusercontent.com/org/projet/main/setup.sh | bash
```

---

## Int√©gration avec GitHub/GitLab

### Badge dans le README

Ajoutez un badge pour indiquer que le projet supporte les DevContainers :

```markdown
[![Open in Dev Containers](https://img.shields.io/static/v1?label=Dev%20Containers&message=Open&color=blue&logo=visualstudiocode)](https://vscode.dev/redirect?url=vscode://ms-vscode-remote.remote-containers/cloneInVolume?url=https://github.com/org/projet)
```

### GitHub Codespaces

Si vous utilisez GitHub, les DevContainers fonctionnent aussi avec **GitHub Codespaces** (environnement de dev dans le cloud).

Le m√™me `devcontainer.json` est utilis√©. Les d√©veloppeurs peuvent cliquer sur "Code" ‚Üí "Open with Codespaces" pour avoir un environnement complet dans leur navigateur.

### Template de repository

Cr√©ez un **template repository** avec :
- `.devcontainer/devcontainer.json` pr√©-configur√©
- `.vscode/` avec tasks et launch configs
- `CMakeLists.txt` de base
- `README.md` avec instructions
- Structure de dossiers (`src/`, `include/`, `tests/`)

Les nouveaux projets peuvent d√©marrer √† partir de ce template.

---

## D√©pannage de l'onboarding

### Probl√®mes courants et solutions

#### 1. "Docker daemon is not running"

**Sympt√¥me :** VS Code indique que Docker n'est pas accessible.

**Solutions :**
```bash
# D√©marrer Docker
sudo systemctl start docker

# V√©rifier que Docker fonctionne
docker ps
```

#### 2. "Permission denied" sur Linux

**Sympt√¥me :** Erreurs de permission lors de l'acc√®s √† Docker.

**Solution :**
```bash
# Ajouter l'utilisateur au groupe docker
sudo usermod -aG docker $USER

# Important : se d√©connecter et reconnecter
# ou red√©marrer l'ordinateur
```

#### 3. Le conteneur met trop de temps √† d√©marrer

**Causes possibles :**
- Premi√®re utilisation (t√©l√©chargement de l'image)
- Connexion internet lente
- `postCreateCommand` complexe

**Solutions :**
- Pr√©-t√©l√©charger l'image : `docker pull mcr.microsoft.com/devcontainers/cpp:ubuntu-22.04`
- Optimiser `postCreateCommand`
- Utiliser une image pr√©-construite personnalis√©e

#### 4. Les extensions ne s'installent pas

**Sympt√¥me :** Les extensions list√©es dans `devcontainer.json` ne sont pas install√©es.

**Solutions :**
1. V√©rifiez les IDs des extensions (format : `publisher.extension-name`)
2. Reconstruisez le conteneur : `Ctrl+Shift+P` ‚Üí "Rebuild Container"
3. Consultez les logs : `Ctrl+Shift+P` ‚Üí "Show Container Log"

#### 5. IntelliSense ne fonctionne pas

**Sympt√¥me :** Pas d'auto-compl√©tion, erreurs partout.

**Solutions :**
1. Attendez que l'indexation se termine (ic√¥ne de chargement en bas)
2. V√©rifiez `c_cpp_properties.json`
3. G√©n√©rez `compile_commands.json` avec CMake
4. Rechargez VS Code : `Ctrl+Shift+P` ‚Üí "Developer: Reload Window"

#### 6. Le d√©bogueur ne fonctionne pas

**Sympt√¥me :** Erreur lors du lancement de GDB.

**V√©rifications :**
1. Le programme est compil√© avec `-g` ?
2. Les `runArgs` sont pr√©sents dans `devcontainer.json` ?
   ```json
   "runArgs": ["--cap-add=SYS_PTRACE", "--security-opt", "seccomp=unconfined"]
   ```
3. Le chemin du programme dans `launch.json` est correct ?

### Logs et diagnostic

Pour diagnostiquer les probl√®mes :

```bash
# Logs de l'extension Dev Containers
# Ctrl+Shift+P ‚Üí "Dev Containers: Show Container Log"

# Logs Docker
docker logs <container-id>

# √âtat des conteneurs
docker ps -a

# Espace disque Docker
docker system df
```

### Checklist de d√©pannage

```markdown
## Checklist de d√©pannage DevContainer

### Docker
- [ ] Docker est install√© (`docker --version`)
- [ ] Docker est d√©marr√© (`docker ps` fonctionne)
- [ ] L'utilisateur est dans le groupe docker (Linux)
- [ ] Assez d'espace disque (`docker system df`)

### VS Code
- [ ] VS Code est √† jour
- [ ] Extension Dev Containers install√©e
- [ ] Extension C/C++ install√©e

### Projet
- [ ] Le dossier `.devcontainer/` existe
- [ ] `devcontainer.json` est valide (pas d'erreur de syntaxe)
- [ ] L'image Docker existe ou est accessible

### Connexion
- [ ] Connexion internet active (pour t√©l√©charger les images)
- [ ] Pas de proxy/firewall bloquant Docker Hub
```

---

## Workflow quotidien

### D√©marrage de journ√©e

```
1. Ouvrir VS Code
2. Ouvrir le projet (Ctrl+O ou via terminal)
3. Si demand√©, "Reopen in Container"
4. Attendre quelques secondes
5. Coder !
```

### Fin de journ√©e

```
1. Sauvegarder les fichiers
2. Commit et push si n√©cessaire
3. Fermer VS Code
4. (Le conteneur s'arr√™te automatiquement)
```

### Mise √† jour de l'environnement

Quand un coll√®gue met √† jour le `devcontainer.json` :

```
1. git pull
2. VS Code peut demander de reconstruire
3. Sinon : Ctrl+Shift+P ‚Üí "Dev Containers: Rebuild Container"
4. Attendre la reconstruction
5. Continuer le travail
```

---

## R√©capitulatif

√Ä ce stade, vous savez :

- ‚úÖ Installer les pr√©requis (Docker, VS Code, extension)
- ‚úÖ Ouvrir un projet dans son DevContainer
- ‚úÖ Utiliser les commandes principales de l'extension
- ‚úÖ Cr√©er une documentation d'onboarding efficace
- ‚úÖ G√©rer les pr√©f√©rences personnelles vs partag√©es
- ‚úÖ D√©panner les probl√®mes courants
- ‚úÖ √âtablir un workflow quotidien

**Prochaine √©tape :** Dans la section 2.5.5, nous verrons comment les DevContainers deviennent la "source de v√©rit√©" pour l'environnement de d√©veloppement et comment les int√©grer avec la CI/CD.

---

## Points cl√©s √† retenir

1. **Trois pr√©requis seulement** : Docker, VS Code, extension Dev Containers
2. **"Reopen in Container"** : La commande magique pour entrer dans le DevContainer
3. **Documentation claire** : README avec √©tapes pr√©cises = onboarding r√©ussi
4. **Script de bienvenue** : Guide les nouveaux arrivants
5. **Versionnez le DevContainer** : Il √©volue avec le code
6. **Pr√©f√©rences personnelles** : Utilisez `.vscode/settings.json` (non commit√©)
7. **Logs pour debug** : "Show Container Log" r√©v√®le les probl√®mes
8. **Patience au premier lancement** : T√©l√©chargement de l'image = quelques minutes
9. **Rebuild apr√®s modification** : Toujours reconstruire apr√®s changement de config
10. **M√™me environnement pour tous** : C'est l'objectif et le b√©n√©fice principal

**Citation :**
> "The best onboarding is no onboarding. With DevContainers, developers clone and code."
> ‚Äî Philosophie DevContainer

---


‚è≠Ô∏è [DevContainers comme source de v√©rit√©](/02-configuration-environnement/05.5-devcontainers-source-verite.md)
