üîù Retour au [Sommaire](/SOMMAIRE.md)

# 32.1.1 Syntaxe des commentaires Doxygen

## Introduction

Doxygen est un outil de g√©n√©ration automatique de documentation pour le code C (et d'autres langages). Il analyse votre code source et extrait les commentaires sp√©ciaux que vous avez √©crits pour cr√©er une documentation compl√®te sous forme de pages HTML, PDF, ou autres formats.

La cl√© pour utiliser Doxygen efficacement est de savoir **comment √©crire ces commentaires sp√©ciaux** qui seront reconnus et trait√©s par l'outil. C'est ce que nous allons voir dans cette section.

---

## Pourquoi documenter avec Doxygen ?

Avant de plonger dans la syntaxe, comprenons l'int√©r√™t :

- **Documentation toujours √† jour** : La doc est dans le code, donc elle √©volue avec lui
- **G√©n√©ration automatique** : Plus besoin d'√©crire manuellement des pages de documentation
- **Navigation facilit√©e** : Doxygen cr√©e des liens entre les fonctions, structures, fichiers
- **Standard professionnel** : Utilis√© dans de nombreux projets open-source (Linux kernel, Git, etc.)

---

## Les deux styles principaux de commentaires Doxygen

Doxygen reconna√Æt deux grands styles de commentaires : **JavaDoc** et **Qt**. Les deux sont valides, choisissez celui que vous pr√©f√©rez (ou celui utilis√© dans votre projet).

### Style JavaDoc (recommand√©)

Ce style utilise `/**` pour d√©buter un bloc de commentaire Doxygen :

```c
/**
 * Description br√®ve de la fonction.
 *
 * Description d√©taill√©e optionnelle sur plusieurs lignes
 * qui explique ce que fait la fonction en profondeur.
 */
```

### Style Qt

Ce style utilise `/*!` pour d√©buter un bloc :

```c
/*!
 * Description br√®ve de la fonction.
 *
 * Description d√©taill√©e optionnelle.
 */
```

**Note importante** : Un commentaire C classique (`/* ... */`) ou C++ (`// ...`) **ne sera pas** trait√© par Doxygen. Il faut utiliser les marqueurs sp√©ciaux `/**` ou `/*!`.

---

## Commenter une fonction

### Syntaxe de base

Voici comment documenter une fonction simple :

```c
/**
 * Calcule la somme de deux entiers.
 *
 * Cette fonction prend deux nombres entiers en param√®tres
 * et retourne leur somme.
 *
 * @param a Le premier nombre
 * @param b Le deuxi√®me nombre
 * @return La somme de a et b
 */
int addition(int a, int b) {
    return a + b;
}
```

### Les commandes Doxygen essentielles

Les commandes Doxygen commencent par `@` (ou `\` en alternative) :

| Commande | Usage | Exemple |
|----------|-------|---------|
| `@brief` | Description courte (optionnelle si premi√®re ligne) | `@brief Calcule une somme` |
| `@param` | D√©crit un param√®tre | `@param a Premier nombre` |
| `@return` | D√©crit la valeur de retour | `@return Somme des deux nombres` |
| `@note` | Ajoute une note importante | `@note Cette fonction ne v√©rifie pas les overflows` |
| `@warning` | Ajoute un avertissement | `@warning Ne pas passer NULL en param√®tre` |
| `@see` | R√©f√©rence une autre fonction/structure | `@see soustraction()` |
| `@deprecated` | Indique que la fonction est obsol√®te | `@deprecated Utilisez addition_v2()` |

### Exemple complet

```c
/**
 * @brief Divise deux nombres entiers.
 *
 * Cette fonction effectue une division enti√®re entre deux nombres.
 * Le r√©sultat est arrondi vers z√©ro (troncature).
 *
 * @param numerateur Le nombre √† diviser
 * @param denominateur Le diviseur (doit √™tre diff√©rent de z√©ro)
 * @return Le quotient de la division
 *
 * @warning Le d√©nominateur ne doit jamais √™tre z√©ro. Aucune v√©rification
 *          n'est effectu√©e, l'appelant doit s'en assurer.
 *
 * @note Cette fonction utilise la division enti√®re C standard.
 *
 * @see modulo()
 */
int division(int numerateur, int denominateur) {
    return numerateur / denominateur;
}
```

---

## Commenter une structure

Pour documenter une structure (ou un `typedef`), placez le commentaire Doxygen juste avant sa d√©claration :

```c
/**
 * @brief Repr√©sente un point dans un plan 2D.
 *
 * Cette structure contient les coordonn√©es cart√©siennes
 * d'un point dans un espace √† deux dimensions.
 */
typedef struct {
    int x;  /**< Coordonn√©e X (abscisse) */
    int y;  /**< Coordonn√©e Y (ordonn√©e) */
} Point;
```

**Astuce** : Utilisez `/**<` pour documenter un membre **apr√®s** sa d√©claration (commentaire "postfix").

### Exemple avec description d√©taill√©e des membres

```c
/**
 * @brief Structure repr√©sentant un utilisateur.
 *
 * Contient les informations de base d'un utilisateur
 * du syst√®me.
 */
typedef struct {
    char nom[50];        /**< Nom de famille (max 49 caract√®res + '\0') */
    char prenom[50];     /**< Pr√©nom (max 49 caract√®res + '\0') */
    int age;             /**< √Çge en ann√©es */
    bool est_actif;      /**< true si le compte est actif, false sinon */
} Utilisateur;
```

---

## Commenter un fichier

Il est recommand√© d'ajouter un bloc de documentation en **d√©but de fichier** pour expliquer son r√¥le :

```c
/**
 * @file math_utils.c
 * @brief Utilitaires math√©matiques de base.
 *
 * Ce fichier contient des fonctions math√©matiques simples
 * utilis√©es dans l'ensemble du projet.
 *
 * @author Votre Nom
 * @date 2025-01-15
 * @version 1.0
 */

#include <stdio.h>
#include "math_utils.h"

// ... reste du code
```

### Commandes pour les fichiers

| Commande | Usage |
|----------|-------|
| `@file` | Nom du fichier |
| `@brief` | Description courte du fichier |
| `@author` | Auteur(s) du fichier |
| `@date` | Date de cr√©ation |
| `@version` | Version actuelle |
| `@copyright` | Informations de copyright |

---

## Commentaires en ligne (inline)

Pour les variables globales ou les `#define`, utilisez des commentaires plus courts :

```c
#define MAX_BUFFER 1024  /**< Taille maximale du buffer en octets */

int compteur_global = 0;  /**< Compte le nombre d'op√©rations effectu√©es */
```

Ou, si vous pr√©f√©rez le commentaire avant :

```c
/** Taille maximale du buffer en octets */
#define MAX_BUFFER 1024

/** Compte le nombre d'op√©rations effectu√©es */
int compteur_global = 0;
```

---

## Commenter une √©num√©ration

```c
/**
 * @brief √âtats possibles d'une connexion r√©seau.
 */
typedef enum {
    ETAT_DECONNECTE,    /**< Aucune connexion active */
    ETAT_CONNEXION,     /**< Connexion en cours d'√©tablissement */
    ETAT_CONNECTE,      /**< Connexion √©tablie et active */
    ETAT_ERREUR         /**< Erreur de connexion */
} EtatConnexion;
```

---

## Listes et formatage du texte

Doxygen supporte le formatage Markdown dans les commentaires :

### Listes √† puces

```c
/**
 * @brief Configure le serveur HTTP.
 *
 * Cette fonction initialise le serveur avec les param√®tres suivants :
 * - Port d'√©coute
 * - Nombre maximum de connexions
 * - Timeout des requ√™tes
 * - R√©pertoire racine des fichiers statiques
 *
 * @param config Pointeur vers la structure de configuration
 * @return 0 en cas de succ√®s, -1 en cas d'erreur
 */
```

### Listes num√©rot√©es

```c
/**
 * @brief Initialise la base de donn√©es.
 *
 * √âtapes d'initialisation :
 * 1. V√©rification de l'existence du fichier
 * 2. Cr√©ation des tables si n√©cessaire
 * 3. Chargement des donn√©es en cache
 * 4. Validation de l'int√©grit√©
 */
```

### Code dans les commentaires

Utilisez des backticks pour du code inline ou des blocs avec triple backticks :

```c
/**
 * @brief Parse une cha√Æne JSON.
 *
 * Exemple d'utilisation :
 * ```c
 * char *json = "{\"nom\": \"Alice\", \"age\": 30}";
 * Utilisateur *user = parse_json(json);
 * ```
 *
 * @param json_str Cha√Æne JSON √† parser
 * @return Pointeur vers la structure cr√©√©e, ou NULL en cas d'erreur
 */
```

---

## Groupes de fonctions

Pour organiser votre documentation, vous pouvez cr√©er des **groupes** :

```c
/**
 * @defgroup math_ops Op√©rations math√©matiques
 * @brief Fonctions math√©matiques de base.
 * @{
 */

/**
 * @brief Addition de deux entiers.
 */
int addition(int a, int b) {
    return a + b;
}

/**
 * @brief Soustraction de deux entiers.
 */
int soustraction(int a, int b) {
    return a - b;
}

/** @} */ // Fin du groupe math_ops
```

---

## Liens entre √©l√©ments

Doxygen cr√©e automatiquement des liens, mais vous pouvez en ajouter manuellement :

```c
/**
 * @brief Envoie un message via le socket.
 *
 * Cette fonction utilise send() pour transmettre les donn√©es.
 * Voir aussi recevoir_message() pour la r√©ception.
 *
 * @param socket Descripteur du socket
 * @param message Message √† envoyer
 * @param taille Taille du message
 * @return Nombre d'octets envoy√©s, -1 en cas d'erreur
 *
 * @see recevoir_message()
 * @see creer_socket()
 */
int envoyer_message(int socket, const char *message, size_t taille);
```

---

## Tableaux dans les commentaires

Vous pouvez cr√©er des tableaux en Markdown :

```c
/**
 * @brief D√©finit le niveau de log.
 *
 * | Niveau | Valeur | Description |
 * |--------|--------|-------------|
 * | DEBUG  | 0      | Informations d√©taill√©es |
 * | INFO   | 1      | Messages informatifs |
 * | WARN   | 2      | Avertissements |
 * | ERROR  | 3      | Erreurs critiques |
 *
 * @param niveau Niveau de log (0-3)
 */
void set_log_level(int niveau);
```

---

## Bonnes pratiques

### 1. **Soyez concis mais pr√©cis**

‚ùå Mauvais :
```c
/**
 * Fait un truc.
 */
int faire_truc(int x);
```

‚úÖ Bon :
```c
/**
 * @brief Calcule le carr√© d'un nombre.
 *
 * @param x Le nombre √† √©lever au carr√©
 * @return x multipli√© par lui-m√™me
 */
int carre(int x);
```

### 2. **Documentez TOUS les param√®tres et la valeur de retour**

M√™me si cela semble √©vident, documentez syst√©matiquement :
- Tous les param√®tres (`@param`)
- La valeur de retour (`@return`)
- Les √©ventuels effets de bord

### 3. **Mentionnez les cas limites et les erreurs**

```c
/**
 * @brief Alloue un tableau dynamique.
 *
 * @param taille Nombre d'√©l√©ments √† allouer (doit √™tre > 0)
 * @return Pointeur vers le tableau allou√©, ou NULL si :
 *         - taille est 0 ou n√©gative
 *         - l'allocation m√©moire √©choue
 *
 * @warning L'appelant doit lib√©rer la m√©moire avec free()
 */
int* allouer_tableau(int taille);
```

### 4. **Utilisez `@warning` pour les pi√®ges**

```c
/**
 * @brief Convertit une cha√Æne en entier.
 *
 * @param str Cha√Æne √† convertir
 * @return Valeur enti√®re
 *
 * @warning Cette fonction ne v√©rifie pas la validit√© de la cha√Æne.
 *          Une cha√Æne invalide peut causer un comportement ind√©fini.
 */
```

### 5. **S√©parez description br√®ve et d√©taill√©e**

La premi√®re phrase (ou ligne avec `@brief`) doit √™tre un r√©sum√©. Les d√©tails viennent apr√®s une ligne vide :

```c
/**
 * @brief Trie un tableau d'entiers.
 *
 * Cette fonction impl√©mente l'algorithme QuickSort avec une
 * complexit√© moyenne de O(n log n). Le tri est effectu√© en place,
 * c'est-√†-dire que le tableau original est modifi√©.
 *
 * @param tableau Tableau √† trier
 * @param taille Nombre d'√©l√©ments dans le tableau
 */
void tri_rapide(int *tableau, size_t taille);
```

---

## Commandes avanc√©es (aper√ßu)

Pour information, Doxygen offre d'autres commandes utiles :

- `@todo` : Marque une t√¢che √† faire
- `@bug` : Signale un bug connu
- `@attention` : Attire l'attention
- `@pre` : Pr√©condition (ce qui doit √™tre vrai avant l'appel)
- `@post` : Postcondition (ce qui sera vrai apr√®s l'appel)
- `@code ... @endcode` : Bloc de code (alternative aux triple backticks)

Exemple :

```c
/**
 * @brief Ouvre un fichier en lecture.
 *
 * @param chemin Chemin vers le fichier
 * @return Descripteur de fichier, ou -1 en cas d'erreur
 *
 * @pre Le chemin doit √™tre une cha√Æne valide termin√©e par '\0'
 * @post Si retour >= 0, le fichier est ouvert et doit √™tre ferm√© avec close()
 *
 * @todo Ajouter le support des chemins Unicode
 * @bug Ne g√®re pas correctement les liens symboliques cass√©s
 */
int ouvrir_fichier(const char *chemin);
```

---

## Style @-commands vs \-commands

Doxygen accepte deux syntaxes pour les commandes :

- **Style @** : `@param`, `@return`, `@brief`
- **Style \** : `\param`, `\return`, `\brief`

Les deux sont strictement √©quivalents. Le style `@` est plus courant dans la communaut√© C/C++, mais choisissez celui qui vous convient et **restez coh√©rent** dans tout votre projet.

---

## R√©sum√© visuel

Voici un exemple complet qui r√©capitule les concepts :

```c
/**
 * @file reseau.h
 * @brief Module de gestion des connexions r√©seau.
 * @author √âquipe R√©seau
 * @date 2025-01-15
 */

/**
 * @brief Cr√©e un socket TCP.
 *
 * Cette fonction initialise un socket TCP en mode client
 * et le configure avec les options par d√©faut.
 *
 * √âtapes effectu√©es :
 * 1. Cr√©ation du socket avec socket()
 * 2. Configuration des options (SO_REUSEADDR)
 * 3. V√©rification de la validit√©
 *
 * @param port Port sur lequel √©couter (1024-65535 recommand√©)
 * @return Descripteur du socket cr√©√©, ou -1 en cas d'erreur
 *
 * @note Le socket cr√©√© doit √™tre ferm√© avec close() apr√®s usage
 * @warning Ne pas utiliser de ports r√©serv√©s (< 1024) sans privil√®ges root
 *
 * @see fermer_socket()
 * @see connecter_socket()
 */
int creer_socket_tcp(int port);
```

---

## Conclusion

La syntaxe des commentaires Doxygen peut sembler intimidante au d√©but, mais elle devient naturelle avec la pratique. Retenez l'essentiel :

1. **Utilisez `/**` ou `/*!`** pour que Doxygen reconnaisse vos commentaires
2. **Documentez syst√©matiquement** : fonctions, structures, fichiers, param√®tres, retours
3. **Soyez pr√©cis et utile** : la doc est pour les autres d√©veloppeurs (et vous dans 6 mois !)
4. **Restez coh√©rent** : choisissez un style et tenez-vous-y

Dans la prochaine section (32.1.2), nous verrons comment **g√©n√©rer** cette documentation au format HTML et PDF.

---

**Ressources compl√©mentaires :**
- Documentation officielle Doxygen : https://www.doxygen.nl/manual/docblocks.html
- Liste compl√®te des commandes : https://www.doxygen.nl/manual/commands.html

‚è≠Ô∏è [G√©n√©ration HTML/PDF](/32-documentation-maintenance/01.2-generation-html-pdf.md)
